<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>계원예술대학교 미식지도</title>
    <style>
        /* 기본 리셋 및 폰트 설정 */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Noto Sans KR', 'Noto Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background-color: #F2F4F7;
            color: #111827;
            margin: 0;
            padding: 0;
            width: 100%;
            max-width: 375px;
            margin: 0 auto;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* 화면 전환용 기본 스타일 */
        .screen {
            display: none;
            min-height: 100vh;
            padding-bottom: 81px;
        }

        .screen.active {
            display: block;
        }

        /* 헤더 */
        .header {
            background-color: #F5F8F8;
            border-bottom: 1px solid #F3F4F6;
            width: 100%;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 375px;
            margin: 0 auto;
            padding: 18px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .header-title {
            font-size: 18px;
            line-height: 28px;
            font-weight: 400;
            color: #111827;
        }

        .notification-btn {
            width: 44px;
            height: 44px;
            background: transparent;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .notification-btn:hover {
            background-color: #F3F4F6;
        }

        .notification-btn img {
            width: 24px;
            height: 24px;
            object-fit: contain;
        }

        /* 메인 콘텐츠 */
        .main-content {
            padding: 24px 20px;
            max-width: 375px;
            margin: 0 auto;
        }

        /* 제목 섹션 */
        .title-section {
            margin-bottom: 24px;
        }

        .title-line {
            font-size: 24px;
            line-height: 32px;
            font-weight: 400;
            color: #000000;
            margin: 0;
        }

        /* 카테고리 그리드 */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 32px;
        }

        .category-btn {
            background-color: #FF4500;
            border: none;
            border-radius: 16px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
            transition: all 0.2s;
        }

        .category-btn:active {
            transform: scale(0.98);
        }

        .category-text {
            color: #FFFFFF;
            font-size: 20px;
            font-weight: 400;
            text-align: center;
        }

        /* 랜덤 추천 섹션 */
        .random-section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 1) 0%);
            border-radius: 16px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1);
        }

        .random-icon-wrapper {
            width: 80px;
            height: 80px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .random-icon-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .random-title {
            font-size: 18px;
            line-height: 28px;
            font-weight: 400;
            color: #111827;
            text-align: center;
            margin-bottom: 8px;
        }

        .random-subtitle {
            font-size: 14px;
            line-height: 20px;
            font-weight: 400;
            color: #4B5563;
            text-align: center;
            margin-bottom: 16px;
        }

        .random-btn {
            width: 100%;
            height: 48px;
            background-color: #FD4B21;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.05);
            transition: background-color 0.2s;
        }

        .random-btn:hover {
            background-color: #FF5939;
        }

        .random-btn:active {
            transform: scale(0.98);
        }

        .random-btn-text {
            color: #FFFFFF;
            font-size: 16px;
            font-weight: 400;
            text-align: center;
        }

        /* 하단 네비게이션 */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 375px;
            background-color: #FFFFFF;
            border-top: 1px solid #E5E7EB;
            z-index: 100;
            display: none; /* 기본적으로 숨김 */
        }
        
        .bottom-nav.show {
            display: block !important; /* 홈 화면에서만 표시 */
        }

        .nav-content {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 9px 0;
            max-width: 375px;
            margin: 0 auto;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 8px;
            transition: color 0.2s;
        }

        .nav-item svg {
            width: 23px;
            height: 20px;
        }

        .nav-item.active {
            color: #FC7951;
        }

        .nav-item:not(.active) {
            color: #9CA3AF;
        }

        .nav-label {
            font-size: 12px;
            line-height: 16px;
            font-weight: 400;
        }

        /* 기록 화면 스타일 */
        .back-btn {
            background: transparent;
            border: none;
            padding: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
        }

        .back-btn svg {
            width: 24px;
            height: 24px;
            color: #111827;
        }

        .meal-record-form {
            background: #F2F4F7;
            padding: 20px;
            max-width: 375px;
            margin: 0 auto;
            padding-bottom: 100px;
        }

        .card-content {
            background: #F2F4F7;
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0px 4px 6px -4px rgba(0, 0, 0, 0.1), 0px 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            font-size: 14px;
            font-weight: 400;
            color: #000000;
        }

        .form-label svg {
            width: 20px;
            height: 20px;
        }

        .required {
            color: #FF6B4A;
            font-size: 16px;
        }

        .optional {
            color: #000000;
            font-size: 14px;
        }

        .form-select {
            width: 100%;
            background: #CACED5;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 14px;
            color: #FFFFFF;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .form-select:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .form-select option {
            background: #CACED5;
            color: #000000;
        }

        .form-input {
            width: 100%;
            background: #FFFFFF;
            border: 1px solid #CACED5;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 14px;
            color: #000000;
        }

        .form-input::placeholder {
            color: #9CA3AF;
        }

        .submit-custom-btn,
        .cancel-custom-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .submit-custom-btn {
            background: #FD4B21;
            color: #FFFFFF;
        }

        .submit-custom-btn:hover {
            background: #FF5939;
        }

        .cancel-custom-btn {
            background: #CACED5;
            color: #FFFFFF;
        }

        .cancel-custom-btn:hover {
            background: #9CA3AF;
        }

        .add-restaurant-btn,
        .add-keyword-btn {
            background: #CACED5;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #FFFFFF;
            cursor: pointer;
            width: 100%;
            justify-content: flex-start;
        }

        .form-description {
            color: #9CA3AF;
            font-size: 14px;
            line-height: 20px;
            margin-bottom: 12px;
        }

        .time-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .time-btn {
            background: rgba(253, 75, 33, 0.3);
            border: 1px solid rgba(255, 107, 74, 0.4);
            border-radius: 10px;
            padding: 12px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.2s;
        }

        .time-btn:hover {
            background: rgba(253, 75, 33, 0.5);
            color: rgba(255, 255, 255, 0.9);
        }

        .time-btn.active {
            background: #FD4B21;
            border: 2px solid #FF6B4A;
            color: #FFFFFF;
            box-shadow: 0 0 0 3px rgba(255, 107, 74, 0.4), 0 4px 8px rgba(0, 0, 0, 0.2);
            transform: scale(1.02);
            font-weight: 600;
        }

        .mood-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .mood-btn {
            background: rgba(253, 75, 33, 0.3);
            border: 1px solid rgba(255, 107, 74, 0.4);
            border-radius: 14px;
            padding: 12px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .mood-btn:hover {
            background: rgba(253, 75, 33, 0.5);
        }

        .mood-btn.active {
            background: #FD4B21;
            border: 2px solid #FF6B4A;
            box-shadow: 0 0 0 3px rgba(255, 107, 74, 0.4), 0 4px 8px rgba(0, 0, 0, 0.2);
            transform: scale(1.05);
        }

        .mood-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        .mood-btn.active .mood-label {
            color: #FFFFFF;
            font-weight: 600;
        }

        .mood-emoji {
            font-size: 30px;
            line-height: 36px;
        }

        .mood-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }

        .rating-item {
            margin-bottom: 16px;
        }

        .rating-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
            color: rgba(0, 0, 0, 0.8);
        }

        .rating-score {
            color: #FF6B4A;
            font-size: 14px;
        }

        .rating-stars {
            display: flex;
            gap: 4px;
        }

        .star-btn {
            background: transparent;
            border: none;
            padding: 0;
            cursor: pointer;
            font-size: 32px;
            color: #FF6B4A;
            transition: all 0.2s;
            position: relative;
            opacity: 0.3;
        }

        .star-btn::before {
            content: '⭐';
            position: absolute;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .star-btn.active {
            color: #FF6B4A;
            opacity: 1;
        }

        .star-btn.active::before {
            opacity: 1;
        }

        .visual-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .visual-btn {
            background: rgba(253, 75, 33, 0.3);
            border: 1px solid rgba(255, 107, 74, 0.4);
            border-radius: 10px;
            padding: 12px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.2s;
        }

        .visual-btn:hover {
            background: rgba(253, 75, 33, 0.5);
            color: rgba(255, 255, 255, 0.9);
        }

        .visual-btn.active {
            background: #FD4B21;
            border: 2px solid #FF6B4A;
            color: #FFFFFF;
            box-shadow: 0 0 0 3px rgba(255, 107, 74, 0.4), 0 4px 8px rgba(0, 0, 0, 0.2);
            transform: scale(1.02);
            font-weight: 600;
        }

        .keyword-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .keyword-badge {
            background: transparent;
            border: 2px solid #FD4B21;
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 12px;
            color: #FD4B21;
            cursor: pointer;
            transition: all 0.2s;
        }

        .keyword-badge.active {
            background: #E63900;
            border: 2px solid #FF6B4A;
            color: #FFFFFF;
            box-shadow: 0 0 0 2px rgba(255, 107, 74, 0.3), 0 2px 4px rgba(0, 0, 0, 0.15);
            transform: scale(1.05);
            font-weight: 600;
        }

        .photo-upload {
            border: 1px dashed rgba(255, 255, 255, 0.2);
            border-radius: 14px;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .photo-upload:hover {
            border-color: #FD4B21;
        }

        .photo-upload svg {
            width: 32px;
            height: 32px;
        }

        .photo-upload span {
            font-size: 14px;
            color: #CACED5;
        }

        .info-card {
            background: rgba(45, 45, 68, 0.5);
            border-radius: 14px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .info-card svg {
            width: 16px;
            height: 16px;
        }

        .info-card span {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
        }

        .submit-btn {
            width: 100%;
            background: #FD4B21;
            border: none;
            border-radius: 8px;
            padding: 14px;
            font-size: 14px;
            color: #FFFFFF;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 16px;
        }

        .submit-btn:hover {
            background: #FF5939;
        }

        .submit-btn:active {
            transform: scale(0.98);
        }

        /* 지도 화면 스타일 */
        #mapScreen {
            touch-action: pan-y; /* 수직 스크롤만 허용 */
            overscroll-behavior: none; /* 스크롤 바운스 효과 제거 */
            -webkit-overflow-scrolling: touch;
        }
        
        .map-filter-container {
            background: #FD4B21;
            border-radius: 16px;
            padding: 13px;
            margin: 20px;
            margin-top: 10px;
            box-shadow: 0px 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .map-filter-buttons {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            flex-wrap: nowrap;
            scrollbar-width: none; /* Firefox */
        }

        .map-filter-buttons::-webkit-scrollbar {
            display: none;
        }

        .map-filter-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 14px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
            transition: all 0.2s;
            box-shadow: 0px 4px 6px -4px rgba(0, 0, 0, 0.1), 0px 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .map-filter-btn.active {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0px 4px 15px 0px rgba(0, 0, 0, 0.1);
        }

        .map-filter-btn:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }

        .filter-emoji {
            font-size: 20px;
            line-height: 28px;
        }

        .filter-text {
            color: #FFFFFF;
            font-size: 14px;
            line-height: 20px;
        }

        .map-filter-btn:not(.active) .filter-text {
            color: rgba(255, 255, 255, 0.7);
        }

        .filter-badge {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 2px 8px;
            font-size: 12px;
            line-height: 16px;
            color: rgba(255, 255, 255, 0.6);
        }

        .map-filter-btn.active .filter-badge {
            background: rgba(255, 255, 255, 0.2);
        }

        /* 카테고리별 식당 리스트 */
        .category-restaurant-list {
            padding: 20px;
            padding-bottom: 100px; /* 하단 네비게이션 바 공간 확보 */
            background: #FFFFFF;
        }

        .category-section {
            margin-bottom: 32px;
        }

        .category-section:last-child {
            margin-bottom: 0;
        }

        .category-section-header {
            margin-bottom: 16px;
        }

        .category-section-title {
            color: #111827;
            font-size: 16px;
            font-weight: 600;
            margin: 0;
        }

        .category-section-count {
            color: #FD4B21;
            font-size: 14px;
            margin-left: 4px;
            font-weight: 500;
        }

        .category-restaurant-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .map-view-container {
            position: relative;
            width: 100%;
            height: 40vh; /* 높이를 더 줄여서 빈 공간 최소화 */
            min-height: 300px;
            margin-top: 10px;
            touch-action: pan-y; /* 수직 스크롤만 허용 */
            overscroll-behavior: none; /* 스크롤 바운스 효과 제거 */
            -webkit-overflow-scrolling: touch;
        }

        .map-background {
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #FFFFFF 0%, #F8FAFC 50%, #F1F5F9 100%);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: pan-y; /* 수직 스크롤만 허용 */
            overscroll-behavior: none; /* 스크롤 바운스 효과 제거 */
        }

        .map-background::before {
            content: '';
            position: absolute;
            inset: 0;
            background: 
                radial-gradient(ellipse 800px 400px at 80% 20%, rgba(253, 107, 74, 0.08) 0%, transparent 40%),
                radial-gradient(ellipse 600px 300px at 20% 80%, rgba(100, 116, 139, 0.06) 0%, transparent 40%);
            pointer-events: none;
        }

        /* 배경 그리드 */
        .map-grid {
            position: absolute;
            inset: 0;
            opacity: 0;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            width: 100%;
            height: 100%;
        }

        .map-grid-cell {
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 지도 중앙 학교 마커 */
        .school-marker {
            display: none; /* 학교 마커 숨김 */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        .school-marker-main {
            position: relative;
            width: 48px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .school-marker-main::before {
            content: '';
            position: absolute;
            width: 48px;
            height: 48px;
            background: white;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            border: 3px solid #FD4B21;
            box-shadow: 0px 6px 20px rgba(253, 75, 33, 0.25);
            z-index: -1;
        }

        .school-marker-label {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #111827;
            white-space: nowrap;
            background: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #E5E7EB;
        }

        /* 거리 범위 표시 - 숨김 */
        .distance-ring {
            display: none;
        }

        .distance-ring.green {
            display: none;
        }

        .distance-ring.yellow {
            display: none;
        }

        .distance-ring.orange {
            display: none;
            border: 1px dashed rgba(253, 107, 74, 0.08);
        }

        /* 범례 */
        .map-legend {
            display: none; /* 범례 숨김 */
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 8px;
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #FD4B21;
        }

        /* 식당 리스트 */
        .map-restaurant-list {
            padding: 20px;
            background: linear-gradient(180deg, #F2F4F7 0%, #FFFFFF 100%);
            max-height: 280px;
            overflow-y: auto;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .map-restaurant-list::-webkit-scrollbar {
            width: 6px;
        }

        .map-restaurant-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .map-restaurant-list::-webkit-scrollbar-thumb {
            background: #DDD;
            border-radius: 3px;
        }

        .list-header {
            margin-bottom: 16px;
        }

        .list-title {
            color: #111827;
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 0.5px;
            margin: 0;
        }

        .list-count {
            color: #FD4B21;
            font-size: 14px;
            margin-left: 4px;
            font-weight: 500;
        }

        .list-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .restaurant-list-item {
            background: #FFFFFF;
            border-radius: 14px;
            padding: 16px;
            border: 1px solid #E8E8E8;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .restaurant-list-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, #FD4B21 0%, #FF7B54 100%);
            transform: scaleY(0);
            transform-origin: center;
            transition: transform 0.3s ease-out;
        }

        .restaurant-list-item:hover {
            border-color: #FD4B21;
            transform: translateX(4px) translateY(-2px);
            box-shadow: 
                0px 8px 16px rgba(253, 75, 33, 0.12),
                0px 2px 4px rgba(0, 0, 0, 0.06);
            background: linear-gradient(135deg, #FFFFFF 0%, #FFFBF8 100%);
        }

        .restaurant-list-item:hover::before {
            transform: scaleY(1);
        }

        .restaurant-list-item-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 1;
        }

        .restaurant-list-item-left {
            display: flex;
            align-items: center;
            gap: 14px;
            flex: 1;
        }

        .restaurant-list-emoji {
            font-size: 36px;
            line-height: 1;
            filter: drop-shadow(0px 2px 4px rgba(253, 75, 33, 0.2));
            transition: transform 0.3s ease-out;
        }

        .restaurant-list-item:hover .restaurant-list-emoji {
            transform: scale(1.15) rotate(-5deg);
        }

        .restaurant-list-info {
            flex: 1;
        }

        .restaurant-list-name {
            color: #111827;
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 6px 0;
            letter-spacing: 0.3px;
        }

        .restaurant-list-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        .restaurant-list-distance {
            color: #9CA3AF;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .restaurant-list-arrow {
            color: #FD4B21;
            font-size: 20px;
            transition: all 0.3s ease-out;
            opacity: 0.6;
        }

        .restaurant-list-item:hover .restaurant-list-arrow {
            transform: translateX(4px);
            opacity: 1;
        }

        .distance-color-green {
            color: #4ADE80;
        }

        .distance-color-yellow {
            color: #FACC15;
        }

        .distance-color-orange {
            color: #FB923C;
        }

        .distance-color-red {
            color: #F87171;
        }

        /* 식당 마커 */
        .restaurant-marker {
            position: absolute;
            width: 48px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 5;
        }

        .restaurant-marker::before {
            content: '';
            position: absolute;
            width: 48px;
            height: 48px;
            background: #FD4B21;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            border: 3px solid white;
            box-shadow: 0px 4px 12px rgba(253, 75, 33, 0.3);
            z-index: -1;
        }

        .restaurant-marker:hover {
            transform: translateY(-8px);
        }

        .restaurant-marker:hover::before {
            box-shadow: 0px 8px 20px rgba(253, 75, 33, 0.4);
        }

        .restaurant-marker.active {
            transform: scale(1.2) translateY(-12px);
        }

        .restaurant-marker.active::before {
            box-shadow: 0px 12px 28px rgba(253, 75, 33, 0.5);
            border-width: 4px;
        }

        /* Bottom Sheet 배경 오버레이 */
        .bottom-sheet-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 19;
            pointer-events: none;
        }

        .bottom-sheet-overlay.show {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        .restaurant-card {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(100%);
            width: 100%;
            max-width: 375px;
            background: #FD4B21;
            border-radius: 23px 23px 0 0;
            padding: 25px 16px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0px 25px 50px -12px rgba(0, 0, 0, 0.25);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            touch-action: pan-y;
            -webkit-overflow-scrolling: touch;
            z-index: 20;
        }

        /* Bottom Sheet peek 상태 (일부만 보임 - 네이버 지도 스타일) */
        .restaurant-card.peek {
            transform: translateX(-50%) translateY(40%);
        }

        /* Bottom Sheet 완전히 열림 */
        .restaurant-card.show {
            transform: translateX(-50%) translateY(0);
        }

        .restaurant-card.full {
            max-height: 95vh;
        }

        .card-handle {
            width: 48px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            margin: 0 auto 20px;
            cursor: grab;
            touch-action: none;
            user-select: none;
        }

        .card-handle:active {
            cursor: grabbing;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .card-header-left {
            display: flex;
            gap: 12px;
            align-items: center;
            flex: 1;
        }

        .restaurant-emoji {
            font-size: 36px;
            line-height: 40px;
        }

        .restaurant-info {
            flex: 1;
        }

        .restaurant-name {
            color: #FFFFFF;
            font-size: 16px;
            line-height: 24px;
            font-weight: 400;
            margin: 0 0 4px 0;
        }

        .restaurant-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .distance-badge {
            background: rgba(92, 72, 68, 0.2);
            border-radius: 8px;
            padding: 2px 8px;
            font-size: 12px;
            line-height: 16px;
            color: #FFFFFF;
        }

        .rating-info {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .rating-info svg {
            width: 12px;
            height: 12px;
            color: #FFFFFF;
        }

        .rating-score {
            color: #FFFFFF;
            font-size: 14px;
            line-height: 20px;
        }

        .divider {
            color: rgba(255, 255, 255, 0.4);
            font-size: 12px;
        }

        .review-count {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            line-height: 16px;
        }

        .close-card-btn {
            background: rgba(255, 255, 255, 0.19);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
        }

        .close-card-btn svg {
            width: 16px;
            height: 16px;
            color: #FFFFFF;
        }

        .card-menu-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .menu-section-header {
            color: rgba(255, 255, 255, 0.9);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .menu-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .menu-item {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 10px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .menu-name {
            color: #FFFFFF;
            font-size: 14px;
            font-weight: 500;
        }

        .menu-price {
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
        }

        .card-reviews {
            background: #F2F4F7;
            border-radius: 14px;
            padding: 12px;
            margin-top: 12px;
        }

        .reviews-header {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            line-height: 20px;
            margin-bottom: 8px;
        }

        .review-item {
            background: #F2F4F7;
            border-radius: 14px;
            padding: 12px;
        }

        .review-header {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 8px;
        }

        .reviewer-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .reviewer-name {
            color: #000000;
            font-size: 14px;
            line-height: 20px;
        }

        .reviewer-dept {
            background: #F5D8D5;
            border-radius: 5px;
            padding: 2px 6px;
            color: #FF6B4A;
            font-size: 12px;
            line-height: 16px;
        }

        .review-stars {
            display: flex;
            gap: 2px;
        }

        .review-stars span {
            font-size: 12px;
            color: #FF6B4A;
        }

        .review-menu-badge {
            background: rgba(255, 107, 74, 0.2);
            border-radius: 8px;
            padding: 2px 8px;
            display: inline-block;
        }

        .review-menu-badge span {
            color: #FF6B4A;
            font-size: 12px;
            line-height: 16px;
        }

        .review-time {
            color: rgba(0, 0, 0, 0.4);
            font-size: 12px;
            line-height: 16px;
            margin-bottom: 8px;
        }

        .review-content {
            color: rgba(0, 0, 0, 0.8);
            font-size: 14px;
            line-height: 20px;
            margin-bottom: 12px;
        }

        .review-ratings {
            background: #F3E6E5;
            border-radius: 10px;
            padding: 8px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .rating-item-small {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .rating-item-small span:first-child {
            color: rgba(0, 0, 0, 0.6);
            font-size: 12px;
            line-height: 16px;
        }

        .rating-point {
            color: #FF6B4A;
            font-size: 12px;
            line-height: 16px;
        }

        .review-keywords {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .keyword-badge-small {
            background: rgba(255, 107, 74, 0.1);
            border: 1px solid rgba(255, 107, 74, 0.3);
            border-radius: 8px;
            padding: 2px 8px;
            color: #FF6B4A;
            font-size: 12px;
            line-height: 16px;
        }

        /* 반응형 조정 */
        @media (max-width: 375px) {
            body {
                max-width: 100%;
            }
            
            .header-content,
            .main-content,
            .nav-content,
            .meal-record-form,
            .map-view-container {
                max-width: 100%;
            }

            .map-filter-container {
                margin: 10px;
                padding: 10px;
            }

            .restaurant-card {
                padding: 20px 12px;
            }
        }

        /* 트렌드 화면 스타일 */
        .trend-content {
            background: #F2F4F7;
            padding: 20px;
            padding-bottom: 100px;
            max-width: 375px;
            margin: 0 auto;
        }

        .trend-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #F2F4F7;
            border-radius: 14px;
            padding: 16px;
            box-shadow: 0px 4px 6px -4px rgba(0, 0, 0, 0.1), 0px 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            color: rgba(0, 0, 0, 0.6);
            font-size: 14px;
            line-height: 20px;
            margin-bottom: 4px;
        }

        .stat-value {
            color: #000000;
            font-size: 16px;
            line-height: 24px;
            font-weight: 400;
        }

        .stat-rating {
            display: flex;
            align-items: center;
            gap: 4px;
            background: #E5E7EB;
            border-radius: 10px;
            padding: 4px 8px;
            width: fit-content;
        }

        .stat-rating svg {
            width: 16px;
            height: 16px;
        }

        .stat-rating span {
            color: #000000;
            font-size: 16px;
            line-height: 24px;
        }

        .trend-card {
            background: #F2F4F7;
            border-radius: 14px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0px 4px 6px -4px rgba(0, 0, 0, 0.1), 0px 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .trend-card-title {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 24px;
        }

        .trend-card-title svg {
            width: 20px;
            height: 20px;
        }

        .trend-card-title span {
            color: #000000;
            font-size: 16px;
            line-height: 16px;
            font-weight: 400;
        }

        .tab-list {
            background: #E5E7EB;
            border-radius: 14px;
            padding: 3px;
            display: flex;
            margin-bottom: 24px;
        }

        .tab-btn {
            flex: 1;
            background: transparent;
            border: none;
            border-radius: 14px;
            padding: 4px 8px;
            font-size: 14px;
            line-height: 20px;
            color: #000000;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab-btn.active {
            background: #FD4B21;
            color: #FFFFFF;
        }

        .popular-restaurant-item {
            background: #F3E6E5;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .rank-badge {
            width: 29px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            line-height: 24px;
            font-weight: 400;
            color: #FFFFFF;
        }

        .rank-badge.gold {
            background: #FBBF24;
        }

        .rank-badge.silver {
            background: #94A3B8;
        }

        .rank-badge.bronze {
            background: #D97706;
        }

        .restaurant-emoji-small {
            font-size: 24px;
            line-height: 32px;
        }

        .restaurant-info-small {
            flex: 1;
        }

        .restaurant-name-small {
            color: #000000;
            font-size: 16px;
            line-height: 24px;
            margin-bottom: 4px;
        }

        .restaurant-count {
            color: rgba(0, 0, 0, 0.6);
            font-size: 14px;
            line-height: 20px;
        }

        .restaurant-rating-small {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .restaurant-rating-small svg {
            width: 16px;
            height: 16px;
        }

        .restaurant-rating-small span {
            color: #FD4B21;
            font-size: 16px;
            line-height: 24px;
        }

        .ranking-list-container {
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            scroll-snap-type: x mandatory;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
            padding-bottom: 10px;
        }
        
        .ranking-list-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
        
        .ranking-list {
            display: flex;
            flex-direction: row;
            gap: 16px;
            padding: 0 20px;
            min-width: max-content;
        }
        
        .ranking-item {
            scroll-snap-align: start;
            flex-shrink: 0;
            width: calc(100vw - 120px);
            max-width: 280px;
            position: relative;
            background: #F5DED2;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 17px;
        }

        .ranking-item.featured {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(255, 107, 74, 0.2) 100%);
            border-color: rgba(251, 191, 36, 0.5);
        }

        .ranking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .rank-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            line-height: 24px;
            font-weight: 700;
            color: #FFFFFF;
            box-shadow: 0px 4px 6px -4px rgba(0, 0, 0, 0.1), 0px 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .rank-number.gold {
            background: #FBBF24;
        }

        .rank-number.silver {
            background: #94A3B8;
        }

        .rank-number.bronze {
            background: #D97706;
        }

        .rank-change {
            background: rgba(74, 222, 128, 0.2);
            border-radius: 50px;
            padding: 2px 10px;
            font-size: 12px;
            line-height: 16px;
            color: #4ADE80;
        }

        .rank-change.up {
            background: rgba(74, 222, 128, 0.2);
            color: #4ADE80;
        }

        .ranking-restaurant {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 16px;
        }

        .restaurant-emoji-large {
            font-size: 48px;
            line-height: 48px;
        }

        .ranking-info {
            flex: 1;
        }

        .ranking-name {
            color: #000000;
            font-size: 16px;
            line-height: 24px;
            margin-bottom: 8px;
        }

        .ranking-distance {
            background: rgba(255, 107, 74, 0.2);
            border-radius: 8px;
            padding: 2px 8px;
            display: inline-block;
            color: #FF6B4A;
            font-size: 12px;
            line-height: 16px;
        }

        .ranking-details {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .detail-item span:first-child {
            font-size: 14px;
            line-height: 20px;
            color: rgba(0, 0, 0, 0.6);
        }

        .detail-value {
            color: #000000;
            font-size: 16px;
            line-height: 24px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .detail-value.highlight {
            color: #FD5D37;
        }
        
        .detail-value svg {
            width: 16px;
            height: 16px;
        }

        .ranking-badge-special {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ranking-badge-special span:first-child {
            font-size: 12px;
            line-height: 16px;
            color: #FBBF24;
        }

        .ranking-badge-special span:last-child {
            font-size: 12px;
            line-height: 16px;
            color: #FD4B21;
        }
        
        .ranking-distance-badge {
            background: rgba(255, 107, 74, 0.2);
            border-radius: 8px;
            padding: 2px 8px;
            display: inline-block;
            color: #FF6B4A;
            font-size: 12px;
            line-height: 16px;
        }
        
        .ranking-name {
            color: #000000;
            font-size: 16px;
            line-height: 24px;
            margin-bottom: 8px;
        }
        
        /* 페이지네이션 도트 */
        .ranking-pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 16px;
            padding: 0 20px;
        }
        
        .ranking-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #D1D5DB;
            transition: all 0.3s ease;
        }
        
        .ranking-dot.active {
            background: #FF6B4A;
            width: 24px;
            border-radius: 4px;
        }

        .keyword-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .keyword-item {
            background: rgba(255, 107, 74, 0.1);
            border: 1px solid rgba(255, 107, 74, 0.3);
            border-radius: 8px;
            padding: 2px 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .keyword-text {
            color: #FF6B4A;
            font-size: 12px;
            line-height: 16px;
        }

        .keyword-count {
            color: #FF6B4A;
            font-size: 12px;
            line-height: 16px;
        }

        .recent-records {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .record-item {
            background: #F3E6E5;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            padding: 17px;
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .record-left {
            display: flex;
            gap: 8px;
            align-items: center;
            flex: 1;
        }

        .record-emoji {
            font-size: 24px;
            line-height: 32px;
        }

        .record-info {
            flex: 1;
        }

        .record-menu {
            color: #891A00;
            font-size: 16px;
            line-height: 24px;
            margin-bottom: 8px;
        }

        .record-restaurant {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .record-restaurant svg {
            width: 12px;
            height: 12px;
        }

        .record-restaurant span {
            color: #FD4B21;
            font-size: 14px;
            line-height: 20px;
        }

        .record-stars {
            display: flex;
            gap: 4px;
        }

        .record-stars span {
            font-size: 12px;
            color: #FF6B4A;
        }

        .record-content {
            color: #000000;
            font-size: 14px;
            line-height: 20px;
            margin-bottom: 12px;
        }

        .record-keywords {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .record-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .record-author {
            color: #9D9D9D;
            font-size: 12px;
            line-height: 16px;
        }

        .record-time {
            color: #9D9D9D;
            font-size: 12px;
            line-height: 16px;
        }
    </style>
</head>
<body>
    <!-- 홈 화면 -->
    <section id="homeScreen" class="screen active">
        <!-- 헤더 -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo-icon">
                        <img src="https://i.imgur.com/dIGACdf.png" alt="미식지도 로고">
                    </div>
                    <h1 class="header-title">미식지도</h1>
                </div>
                <button class="notification-btn" aria-label="알림">
                    <img src="https://i.imgur.com/sKOiF0X.png" alt="알림">
                </button>
            </div>
        </header>

        <!-- 메인 콘텐츠 -->
        <main class="main-content">
            <!-- 제목 섹션 -->
            <div class="title-section">
                <h2 class="title-line">오늘은 무엇을</h2>
                <h2 class="title-line">드셨나요?</h2>
            </div>

            <!-- 카테고리 버튼 그리드 -->
            <div class="category-grid" id="categoryContainer">
                <button class="category-btn" data-category="중식">
                    <span class="category-text">중식</span>
                </button>
                <button class="category-btn" data-category="일식">
                    <span class="category-text">일식</span>
                </button>
                <button class="category-btn" data-category="양식">
                    <span class="category-text">양식</span>
                </button>
                <button class="category-btn" data-category="한식">
                    <span class="category-text">한식</span>
                </button>
                <button class="category-btn" data-category="학식당">
                    <span class="category-text">학식당</span>
                </button>
                <button class="category-btn" data-category="디저트">
                    <span class="category-text">디저트</span>
                </button>
            </div>

            <!-- 랜덤 추천 섹션 -->
            <div class="random-section">
                <div class="random-icon-wrapper">
                    <img src="https://i.imgur.com/FUVs45k.png" alt="메뉴 고민">
                </div>
                <h3 class="random-title">메뉴 고민 중이신가요?</h3>
                <p class="random-subtitle">랜덤으로 식당을 추천해드릴게요</p>
                <button class="random-btn" id="randomRecommendBtn">
                    <span class="random-btn-text">랜덤 추천 받기</span>
                </button>
            </div>
        </main>

        <!-- 하단 네비게이션 (홈 화면에서만 표시) -->
        <nav class="bottom-nav show">
            <div class="nav-content">
                <button class="nav-item active" data-view="home" onclick="showScreen('home')">
                    <svg width="23" height="20" viewBox="0 0 23 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 12L5 10M5 10L12 3L19 10M5 10V18C5 18.552 5.448 19 6 19H9M19 10L21 12M19 10V18C19 18.552 18.552 19 18 19H15M9 19C9.552 19 10 18.552 10 18V14C10 13.448 10.448 13 11 13H13C13.552 13 14 13.448 14 14V18C14 18.552 14.448 19 15 19M9 19H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">홈</span>
                </button>
                <button class="nav-item" data-view="map" onclick="showScreen('map')">
                    <svg width="23" height="20" viewBox="0 0 23 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 20L3.553 17.276C3.214 17.107 3 16.76 3 16.382V5.618C3 5.24 3.214 4.893 3.553 4.724L9 2M9 20L15 17M9 20V2M15 17L20.447 19.276C20.786 19.445 21 19.792 21 20.17V7.618C21 7.24 20.786 6.893 20.447 6.724L15 4M15 17V4M15 4L9 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">지도</span>
                </button>
                <button class="nav-item" data-view="trend" onclick="showScreen('trend')">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13 7H20M20 7V14M20 7L13 14L9 10L1 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">트렌드</span>
                </button>
            </div>
        </nav>
    </section>

    <!-- 기록하기 화면 -->
    <section id="recordScreen" class="screen">
        <!-- 헤더 -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <button class="back-btn" onclick="showScreen('home')" aria-label="뒤로가기">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <div class="logo-icon">
                        <img src="https://i.imgur.com/dIGACdf.png" alt="미식지도 로고">
                    </div>
                    <h1 class="header-title">계미지도</h1>
                </div>
                <button class="notification-btn" aria-label="알림">
                    <img src="https://i.imgur.com/sKOiF0X.png" alt="알림">
                </button>
            </div>
        </header>

        <!-- 기록 폼 -->
        <div class="meal-record-form">
            <!-- 위치 선택 -->
            <div class="card-content">
                <div class="form-label">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>위치 선택</span>
                    <span class="required">*</span>
                </div>
                <select id="restaurantSelect" class="form-select">
                    <option value="">식당을 선택하세요</option>
                </select>
                <button class="add-restaurant-btn" id="addRestaurantBtn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 3V13M3 8H13" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>이 플랫폼에 없는 식당 추가 요청</span>
                </button>
                <div id="customRestaurantInput" style="display: none; margin-top: 8px;">
                    <input type="text" id="customRestaurantName" class="form-input" placeholder="식당 이름을 입력해주세요">
                    <div style="display: flex; gap: 8px; margin-top: 8px;">
                        <button class="submit-custom-btn" id="submitCustomRestaurant">추가하기</button>
                        <button class="cancel-custom-btn" id="cancelCustomRestaurant">취소</button>
                    </div>
                </div>
            </div>

            <!-- 메뉴 선택 -->
            <div class="card-content" id="menuSection" style="display: none;">
                <div class="form-label">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 3H5L5.4 5M7 13H10L14 8H5.4M7 13L5.4 5M7 13L4.707 15.293C4.077 15.923 5.293 17 6 17H17M17 17C17 18.105 16.105 19 15 19C13.895 19 13 18.105 13 17C13 15.895 13.895 15 15 15C16.105 15 17 15.895 17 17ZM9 19C9 20.105 8.105 21 7 21C5.895 21 5 20.105 5 19C5 17.895 5.895 17 7 17C8.105 17 9 17.895 9 19Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>메뉴</span>
                    <span class="required">*</span>
                </div>
                <select id="menuSelect" class="form-select" disabled>
                    <option value="">메뉴를 선택하세요</option>
                </select>
            </div>

            <!-- 학과 선택 -->
            <div class="card-content" id="departmentSection" style="display: none;">
                <div class="form-label">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 14l9-5-9-5-9 5 9 5z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>학과</span>
                    <span class="required">*</span>
                </div>
                <select id="departmentSelect" class="form-select">
                    <option value="">학과를 선택하세요</option>
                </select>
            </div>

            <!-- 소요 시간 -->
            <div class="card-content" id="timeSection" style="display: none;">
                <div class="form-label">
                    <span>소요 시간</span>
                </div>
                <p class="form-description">음식이 나오는 데 얼마나 걸렸나요?</p>
                <div class="time-buttons">
                    <button class="time-btn" data-time="5분 미만">5분 미만</button>
                    <button class="time-btn" data-time="5분~15분">5분~15분</button>
                    <button class="time-btn" data-time="15분~25분">15분~25분</button>
                    <button class="time-btn" data-time="25분 이상">25분 이상</button>
                </div>
            </div>

            <!-- 기분 표시 -->
            <div class="card-content" id="moodSection" style="display: none;">
                <div class="form-label">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>기분 표시</span>
                    <span class="required">*</span>
                </div>
                <p class="form-description">음식을 먹고 난 후 나의 기분을 표시해주세요.</p>
                <div class="mood-buttons">
                    <button class="mood-btn" data-mood="행복">
                        <div class="mood-emoji">😊</div>
                        <div class="mood-label">행복</div>
                    </button>
                    <button class="mood-btn" data-mood="만족함">
                        <div class="mood-emoji">😋</div>
                        <div class="mood-label">만족함</div>
                    </button>
                    <button class="mood-btn" data-mood="보통">
                        <div class="mood-emoji">😐</div>
                        <div class="mood-label">보통</div>
                    </button>
                    <button class="mood-btn" data-mood="별로">
                        <div class="mood-emoji">😔</div>
                        <div class="mood-label">별로</div>
                    </button>
                    <button class="mood-btn" data-mood="나른함">
                        <div class="mood-emoji">🤤</div>
                        <div class="mood-label">나른함</div>
                    </button>
                    <button class="mood-btn" data-mood="화남">
                        <div class="mood-emoji">😤</div>
                        <div class="mood-label">화남</div>
                    </button>
                </div>
            </div>

            <!-- 상세 평가 -->
            <div class="card-content" id="ratingSection" style="display: none;">
                <div class="form-label">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>상세 평가</span>
                    <span class="required">*</span>
                </div>
                <div id="ratingContainer"></div>
            </div>

            <!-- 시각 평가 -->
            <div class="card-content" id="visualSection" style="display: none;">
                <div class="form-label">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 4H16V16H4V4Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8 8H12M8 12H12" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>시각 평가</span>
                </div>
                <p class="form-description">음식의 맛을 시각적인 느낌으로 선택해주세요.</p>
                <div class="visual-buttons">
                    <button class="visual-btn">부드러운</button>
                    <button class="visual-btn">시원한</button>
                    <button class="visual-btn">전통적인</button>
                    <button class="visual-btn">발랄한</button>
                    <button class="visual-btn">화려한</button>
                    <button class="visual-btn">소박한</button>
                    <button class="visual-btn">세련된</button>
                    <button class="visual-btn">투박한</button>
                </div>
            </div>

            <!-- 학생 한 줄 팁 -->
            <div class="card-content" id="keywordSection" style="display: none;">
                <div class="form-label">
                    <span>학생 한 줄 팁</span>
                </div>
                <p class="form-description">해당하는 키워드를 모두 선택해주세요</p>
                <button class="add-keyword-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 3V13M3 8H13" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>기타 키워드 추가</span>
                </button>
                <div class="keyword-badges" id="keywordContainer"></div>
            </div>

            <!-- 식사 사진 -->
            <div class="card-content" id="photoSection" style="display: none;">
                <div class="form-label">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 4H16V16H4V4Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8 8C8.552 8 9 7.552 9 7C9 6.448 8.552 6 8 6C7.448 6 7 6.448 7 7C7 7.552 7.448 8 8 8Z" fill="#FF6B4A"/>
                        <path d="M4 12L7 9L10 12L13 9L16 12V16H4V12Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>식사 사진</span>
                    <span class="optional">(선택)</span>
                </div>
                <div class="photo-upload" id="photoUploadArea" style="cursor: pointer;">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16 12V20M12 16H20" stroke="#CACED5" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span id="photoUploadText">사진 업로드</span>
                    <input type="file" id="photoInput" accept="image/*" style="display: none;">
                    <div id="photoPreview" style="display: none; margin-top: 12px;">
                        <img id="photoPreviewImg" src="" alt="미리보기" style="max-width: 100%; max-height: 200px; border-radius: 8px;">
                    </div>
                </div>
            </div>

            <!-- 시간 안내 -->
            <div class="info-card">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 14C11.314 14 14 11.314 14 8C14 4.686 11.314 2 8 2C4.686 2 2 4.686 2 8C2 11.314 4.686 14 8 14Z" stroke="rgba(255,255,255,0.6)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8 6V8M8 10H8.01" stroke="rgba(255,255,255,0.6)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>현재 시간이 자동으로 기록됩니다</span>
            </div>

            <!-- 기록 완료 버튼 -->
            <button class="submit-btn" id="submitBtn">
                <span>기록 완료</span>
            </button>
        </div>

        <!-- 하단 네비게이션 (기록 화면에서는 숨김) -->
        <nav class="bottom-nav" style="display: none;">
            <div class="nav-content">
                <button class="nav-item" data-view="home" onclick="showScreen('home')">
                    <svg width="23" height="20" viewBox="0 0 23 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 12L5 10M5 10L12 3L19 10M5 10V18C5 18.552 5.448 19 6 19H9M19 10L21 12M19 10V18C19 18.552 18.552 19 18 19H15M9 19C9.552 19 10 18.552 10 18V14C10 13.448 10.448 13 11 13H13C13.552 13 14 13.448 14 14V18C14 18.552 14.448 19 15 19M9 19H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">홈</span>
                </button>
                <button class="nav-item" data-view="map">
                    <svg width="23" height="20" viewBox="0 0 23 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 20L3.553 17.276C3.214 17.107 3 16.76 3 16.382V5.618C3 5.24 3.214 4.893 3.553 4.724L9 2M9 20L15 17M9 20V2M15 17L20.447 19.276C20.786 19.445 21 19.792 21 20.17V7.618C21 7.24 20.786 6.893 20.447 6.724L15 4M15 17V4M15 4L9 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">지도</span>
                </button>
                <button class="nav-item" data-view="trend">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13 7H20M20 7V14M20 7L13 14L9 10L1 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">트렌드</span>
                </button>
            </div>
        </nav>
    </section>

    <!-- 지도 화면 -->
    <section id="mapScreen" class="screen">
        <!-- 헤더 -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo-icon">
                        <img src="https://i.imgur.com/dIGACdf.png" alt="미식지도 로고">
                    </div>
                    <h1 class="header-title">미식지도</h1>
                </div>
                <button class="notification-btn" aria-label="알림">
                    <img src="https://i.imgur.com/sKOiF0X.png" alt="알림">
                </button>
            </div>
        </header>

        <!-- 카테고리 필터 -->
        <div class="map-filter-container" id="mapFilterContainer">
            <div class="map-filter-buttons" id="mapFilterButtons">
                <!-- 필터 버튼들이 여기에 동적으로 생성됩니다 -->
            </div>
        </div>

        <!-- 카테고리별 식당 리스트 -->
        <div class="category-restaurant-list" id="categoryRestaurantList">
            <!-- 카테고리별 리스트가 여기에 동적으로 생성됩니다 -->
        </div>

        <!-- 지도 뷰 -->
        <div class="map-view-container">
            <!-- 지도 배경 이미지 영역 -->
            <div class="map-background" id="mapBackground">
                <!-- 배경 그리드 (JavaScript로 동적 생성) -->
                <div class="map-grid" id="mapGrid">
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
            </div>
                <!-- 식당 마커들이 여기에 동적으로 추가됩니다 -->
            </div>

            <!-- 식당 리스트 (지도 아래) - 숨김 -->
            <div class="map-restaurant-list" id="mapRestaurantList" style="display: none;">
                <div class="list-header">
                    <h2 class="list-title">
                        <span id="listTitle">전체 식당</span>
                        <span class="list-count" id="listCount">(0개)</span>
                    </h2>
                </div>
                <div class="list-content" id="restaurantListContent">
                    <!-- 식당 리스트가 여기에 동적으로 추가됩니다 -->
                </div>
            </div>

            <!-- Bottom Sheet 배경 오버레이 -->
            <div class="bottom-sheet-overlay" id="bottomSheetOverlay"></div>

            <!-- 식당 상세 카드 (Bottom Sheet) -->
            <div class="restaurant-card" id="restaurantCard">
                <div class="card-handle"></div>
                <div class="card-header">
                    <div class="card-header-left">
                        <div class="restaurant-emoji"></div>
                        <div class="restaurant-info">
                            <h3 class="restaurant-name"></h3>
                            <div class="restaurant-meta">
                                <span class="distance-badge"></span>
                                <div class="rating-info">
                                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M6 1L7.5 4.5L11 5L8.5 7.5L9 11L6 9L3 11L3.5 7.5L1 5L4.5 4.5L6 1Z" fill="currentColor"/>
                                    </svg>
                                    <span class="rating-score">0.0</span>
                                </div>
                                <span class="divider">·</span>
                                <span class="review-count">0개 리뷰</span>
                            </div>
                        </div>
                    </div>
                    <button class="close-card-btn" id="closeCardBtn">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                </div>
                <div class="card-menu-section" id="cardMenuSection" style="display: none;">
                    <div class="menu-section-header">
                        <span>🍽️ 메뉴</span>
                    </div>
                    <div class="menu-list" id="menuList">
                        <!-- 메뉴 목록이 여기에 동적으로 추가됩니다 -->
                    </div>
                </div>
                <div class="card-reviews">
                    <div class="reviews-header">
                        <span>리뷰 0개</span>
                    </div>
                    <div style="text-align: center; padding: 40px 20px; color: rgba(255, 255, 255, 0.7);">
                        식당을 선택하면 리뷰를 확인할 수 있습니다.
                    </div>
                </div>
            </div>
        </div>

        <!-- 하단 네비게이션 (기록 화면에서는 숨김) -->
        <nav class="bottom-nav" style="display: none;">
            <div class="nav-content">
                <button class="nav-item" data-view="home" onclick="showScreen('home')">
                    <svg width="23" height="20" viewBox="0 0 23 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 12L5 10M5 10L12 3L19 10M5 10V18C5 18.552 5.448 19 6 19H9M19 10L21 12M19 10V18C19 18.552 18.552 19 18 19H15M9 19C9.552 19 10 18.552 10 18V14C10 13.448 10.448 13 11 13H13C13.552 13 14 13.448 14 14V18C14 18.552 14.448 19 15 19M9 19H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">홈</span>
                </button>
                <button class="nav-item active" data-view="map" onclick="showScreen('map')">
                    <svg width="23" height="20" viewBox="0 0 23 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 20L3.553 17.276C3.214 17.107 3 16.76 3 16.382V5.618C3 5.24 3.214 4.893 3.553 4.724L9 2M9 20L15 17M9 20V2M15 17L20.447 19.276C20.786 19.445 21 19.792 21 20.17V7.618C21 7.24 20.786 6.893 20.447 6.724L15 4M15 17V4M15 4L9 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">지도</span>
                </button>
                <button class="nav-item" data-view="trend">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13 7H20M20 7V14M20 7L13 14L9 10L1 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">트렌드</span>
                </button>
            </div>
        </nav>
    </section>

    <!-- 트렌드 화면 -->
    <section id="trendScreen" class="screen">
        <!-- 헤더 -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo-icon">
                        <img src="https://i.imgur.com/dIGACdf.png" alt="미식지도 로고">
                    </div>
                    <h1 class="header-title">미식지도</h1>
                </div>
                <button class="notification-btn" aria-label="알림">
                    <img src="https://i.imgur.com/sKOiF0X.png" alt="알림">
                </button>
            </div>
        </header>

        <!-- 메인 콘텐츠 -->
        <main class="trend-content">
            <!-- 통계 카드 -->
            <div class="trend-stats">
                <div class="stat-card">
                    <div class="stat-label">오늘 기록</div>
                    <div class="stat-value">156건</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">평균 평점</div>
                    <div class="stat-rating">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 1L10 6L16 6L11 9L13 14L8 11L3 14L5 9L0 6L6 6L8 1Z" fill="#FF6B4A"/>
                        </svg>
                        <span>4.2</span>
                    </div>
                </div>
            </div>

            <!-- 오늘의 인기 식당 -->
            <div class="trend-card">
                <div class="trend-card-title">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 1L12 7L18 7L13 11L15 17L10 13L5 17L7 11L2 7L8 7L10 1Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>오늘의 인기 식당</span>
                </div>
                <div class="trend-tabs">
                    <div class="tab-list">
                        <button class="tab-btn active" data-period="today">오늘</button>
                        <button class="tab-btn" data-period="week">이번 주</button>
                        <button class="tab-btn" data-period="month">이번 달</button>
                    </div>
                    <div class="tab-content" id="popularRestaurantsContent">
                        <!-- 동적으로 업데이트됨 -->
                    </div>
                </div>
            </div>

            <!-- 이달의 식당 랭킹 -->
            <div class="trend-card">
                <div class="trend-card-title">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 1L12 7L18 7L13 11L15 17L10 13L5 17L7 11L2 7L8 7L10 1Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>이달의 식당 랭킹</span>
                </div>
                <div class="ranking-list-container">
                    <div class="ranking-list" id="monthlyRankingList">
                        <!-- 동적으로 업데이트됨 -->
                    </div>
                </div>
                <div class="ranking-pagination" id="rankingPagination">
                    <!-- 동적으로 업데이트됨 -->
                </div>
            </div>

            <!-- 인기 키워드 -->
            <div class="trend-card">
                <div class="trend-card-title">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 1L12 7L18 7L13 11L15 17L10 13L5 17L7 11L2 7L8 7L10 1Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>인기 키워드</span>
                </div>
                <div class="keyword-list" id="popularKeywordsList">
                    <!-- 동적으로 업데이트됨 -->
                </div>
            </div>

            <!-- 최근 식사 기록 -->
            <div class="trend-card">
                <div class="trend-card-title">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 1L12 7L18 7L13 11L15 17L10 13L5 17L7 11L2 7L8 7L10 1Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>최근 식사 기록</span>
                </div>
                <div class="recent-records">
                    <div class="record-item">
                        <div class="record-header">
                            <div class="record-left">
                                <div class="record-emoji">😋</div>
                                <div class="record-info">
                                    <div class="record-menu">짜장면</div>
                                    <div class="record-restaurant">
                                        <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M6 1L7 6L12 6L8 9L9 14L6 11L3 14L4 9L0 6L5 6L6 1Z" fill="#FD4B21"/>
                                        </svg>
                                        <span>홍콩반점 (도보 10분)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="record-stars">
                                <span>⭐</span><span>⭐</span><span>⭐</span><span>⭐</span><span>⭐</span>
                            </div>
                        </div>
                        <div class="record-content">면발이 쫄깃하고 짜장 소스가 진해요! 양파도 아삭아삭</div>
                        <div class="record-keywords">
                            <span class="keyword-badge-small">양 많음</span>
                            <span class="keyword-badge-small">가성비 좋음</span>
                            <span class="keyword-badge-small">단골될 듯</span>
                        </div>
                        <div class="record-footer">
                            <span class="record-author">익명 · 디자인학과</span>
                            <span class="record-time">5분 전</span>
                        </div>
                    </div>
                    <div class="record-item">
                        <div class="record-header">
                            <div class="record-left">
                                <div class="record-emoji">🤤</div>
                                <div class="record-info">
                                    <div class="record-menu">마라탕</div>
                                    <div class="record-restaurant">
                                        <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M6 1L7 6L12 6L8 9L9 14L6 11L3 14L4 9L0 6L5 6L6 1Z" fill="#FD4B21"/>
                                        </svg>
                                        <span>차이나팩토리 (도보 15분)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="record-stars">
                                <span>⭐</span><span>⭐</span><span>⭐</span><span>⭐</span><span>⭐</span>
                            </div>
                        </div>
                        <div class="record-content">매운맛 조절 가능하고 건더기 푸짐해요</div>
                        <div class="record-keywords">
                            <span class="keyword-badge-small">매움</span>
                            <span class="keyword-badge-small">빨리 나옴</span>
                            <span class="keyword-badge-small">재방문 의사 있음</span>
                        </div>
                        <div class="record-footer">
                            <span class="record-author">익명 · 영상학과</span>
                            <span class="record-time">15분 전</span>
                        </div>
                    </div>
                    <div class="record-item">
                        <div class="record-header">
                            <div class="record-left">
                                <div class="record-emoji">😊</div>
                                <div class="record-info">
                                    <div class="record-menu">해물짬뽕</div>
                                    <div class="record-restaurant">
                                        <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M6 1L7 6L12 6L8 9L9 14L6 11L3 14L4 9L0 6L5 6L6 1Z" fill="#FD4B21"/>
                                        </svg>
                                        <span>진미짬뽕 (도보 20분)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="record-stars">
                                <span>⭐</span><span>⭐</span><span>⭐</span><span>⭐</span><span>⭐</span>
                            </div>
                        </div>
                        <div class="record-content">국물이 진짜 시원하고 해물 양도 많아요!</div>
                        <div class="record-keywords">
                            <span class="keyword-badge-small">빨리 나옴</span>
                            <span class="keyword-badge-small">혼밥 가능</span>
                            <span class="keyword-badge-small">조용함</span>
                        </div>
                        <div class="record-footer">
                            <span class="record-author">익명 · 회화과</span>
                            <span class="record-time">32분 전</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- 하단 네비게이션 (기록 화면에서는 숨김) -->
        <nav class="bottom-nav" style="display: none;">
            <div class="nav-content">
                <button class="nav-item" data-view="home" onclick="showScreen('home')">
                    <svg width="23" height="20" viewBox="0 0 23 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 12L5 10M5 10L12 3L19 10M5 10V18C5 18.552 5.448 19 6 19H9M19 10L21 12M19 10V18C19 18.552 18.552 19 18 19H15M9 19C9.552 19 10 18.552 10 18V14C10 13.448 10.448 13 11 13H13C13.552 13 14 13.448 14 14V18C14 18.552 14.448 19 15 19M9 19H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">홈</span>
                </button>
                <button class="nav-item" data-view="map" onclick="showScreen('map')">
                    <svg width="23" height="20" viewBox="0 0 23 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 20L3.553 17.276C3.214 17.107 3 16.76 3 16.382V5.618C3 5.24 3.214 4.893 3.553 4.724L9 2M9 20L15 17M9 20V2M15 17L20.447 19.276C20.786 19.445 21 19.792 21 20.17V7.618C21 7.24 20.786 6.893 20.447 6.724L15 4M15 17V4M15 4L9 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">지도</span>
                </button>
                <button class="nav-item active" data-view="trend" onclick="showScreen('trend')">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13 7H20M20 7V14M20 7L13 14L9 10L1 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">트렌드</span>
                </button>
            </div>
        </nav>
    </section>

    <script>
        // ============================================
        // 📊 데이터 정의
        // ============================================
        
        const restaurants = {
            '중식': [
                { name: '황제짬뽕', distance: '도보 10분', menus: ['황제짬뽕', '황제짬뽕밥', '황제얼큰짬뽕', '짜장', '짬뽕', '짬뽕밥', '짜장곱빼기', '탕수육(대/중/소)', '깐풍기(대/중/소)', '팔보채(대/중/소)', '양장피(대/중/소)', '직접 입력...'] },
                { name: '탕화쿵푸마라탕 내손점', distance: '도보 20분', menus: ['마라탕', '마라샹궈', '마라비빔면', '볶음밥', '꿔바로우', '직접 입력...'] },
                { name: '향라원마라탕&훠궈 의왕', distance: '도보 20분', menus: ['마라탕', '마라샹궈', '훠궈', '꿔바로우', '직접 입력...'] },
                { name: '천향짬뽕', distance: '도보 20분', menus: ['등심탕수육+짜장2', '등심탕수육+짜장+짬뽕', '깐풍기+짜장2', '중새우+짜장2', '바게트멘보샤샐러드', '양장피', '중새우', '직접 입력...'] },
                { name: '동보성 의왕', distance: '도보 20분', menus: ['짜장면', '짬뽕', '간짜장', '볶음밥', '짬뽕밥', '탕수육', '깐풍기', '직접 입력...'] },
                { name: '마라공방 의왕내손점', distance: '도보 25분', menus: ['마라탕', '마라샹궈', '꿔바로우(소/대)', '계란볶음밥', '꽃빵튀김', '멘보샤', '미니전', '마라전골(계절메뉴)', '직접 입력...'] }
            ],
            '일식': [
                { name: '저스트카츠 의왕점', distance: '도보 5~10분', menus: ['등심카츠 정식', '안심카츠 정식', '통치즈카츠 정식', '덮밥류', '카레 정식', '면류', '직접 입력...'] },
                { name: '멘구락부 의왕', distance: '도보 10분', menus: ['쇼유라멘', '시오라멘', '쇼유파이탄', '시오파이탄', '매운멸치비빔라멘', '츠케멘', '구락부 오리지널', '한정 메뉴 (주기적으로 변경)', '직접 입력...'] },
                { name: '스시상 의왕', distance: '도보 10~15분', menus: ['모듬초밥', '스시', '후토마끼', '사시미 코스', '정식 메뉴', '직접 입력...'] },
                { name: "윤's카츠", distance: '도보 15분', menus: ['고구마 치즈롤카츠', '고로케', '날치알 치즈롤카츠', '냉모밀', '눈꽃치즈 철판 카츠', '등심 카츠', '직접 입력...'] },
                { name: '싱싱생선 의왕', distance: '도보 15~20분', menus: ['초밥', '활어회', '식사 메뉴', '직접 입력...'] },
                { name: '유부야 의왕점', distance: '도보 20분', menus: ['다양한 종류의 유부초밥', '일식 정보', '직접 입력...'] }
            ],
            '양식': [
                { name: '이삭토스트 의왕계원예술대점', distance: '도보 5~10분', menus: ['햄치즈토스트', '베이컨치즈베이글', '불고기mvp', '딥치즈베이컨', '피자토스트', '베이컨포테이토피자 토스트', '다양한 토스트 메뉴', '커피', '직접 입력...'] },
                { name: '프랭크버거 의왕내손점', distance: '도보 5~10분', menus: ['프랭크버거', '치즈버거', '베이컨치즈버거', '머쉬룸버거', '쉬림프버거', '더블치즈버거', 'JG버거', 'K불고기버거', '핫불고기버거', '세트 메뉴', '사이드 메뉴', '직접 입력...'] },
                { name: '일지오 페페', distance: '도보 10분', menus: ['알리오올리오 파스타', '토마토해산물 파스타', '까르보나라 파스타', '새우로제 파스타', '고르곤졸라 피자', '화덕피자 메뉴', '직접 입력...'] },
                { name: '샐러페 의왕', distance: '도보 10~12분', menus: ['스페셜 치킨에그 샐러드', '구운 닭다리살 샐러드', '포케', '샌드위치', '컷팅 플레이트 샐러드', '퍼펙트 샐러페 샐러드', '맥시칸 샐러페', '그릴드 머쉬룸 샐러드', '직접 입력...'] },
                { name: '도마셰프', distance: '도보 15분', menus: ['스테이크', '필라프', '파스타', '피자', '감바스', '직접 입력...'] },
                { name: '피자마루 의왕내손점', distance: '도보 20분', menus: ['그린티 웰빙도우 피자', '시카고 피자', '몬스터 피자 시리즈', '다양한 피자 메뉴', '직접 입력...'] },
                { name: '롯데리아 롯데마트 의왕점', distance: '도보 20분', menus: ['불고기 버거', '새우 버거', '치즈 버거', '다양한 버거', '세트 메뉴', '직접 입력...'] }
            ],
            '한식': [
                { name: '이층식당 윤경', distance: '도보 5분', menus: ['가정식 백반 (메뉴는 매일 변경)', '김치짜글이', '매콤오징어볶음', '뼈해장국', '직접 입력...'] },
                { name: '엑스라지 텍사스 치킨', distance: '도보 5~10분', menus: ['텍사스 파히타', '텍사스 토스트&치킨', '텍사스 바비큐 치킨 덮밥', '핫치킨 덮밥', '마요 데리야키 치킨 덮밥', '치킨누들수프', '후라이드 치킨', '매콤 볶음 치킨', '훈연 바비큐 치킨', '직접 입력...'] },
                { name: '다온식당', distance: '도보 5~7분', menus: ['가정식 백반 (메뉴는 매일 변경)', '제육볶음', '고등어구이', '직접 입력...'] },
                { name: '밥한술', distance: '도보 15분', menus: ['백반', '국밥', '술국', '순대국', '수육국밥', '얼큰수육국밥', '소내장탕', '감자탕', '뼈해장국', '제육볶음', '오징어볶음', '직접 입력...'] },
                { name: '손큰할매순대국 의왕내손점', distance: '도보 15분', menus: ['순대국', '뼈해장국', '감자탕', '순대곱창볶음', '술국', '수육', '보쌈', '직접 입력...'] },
                { name: '원조옛날보리밥', distance: '도보 15분', menus: ['보리밥', '된장찌개', '제육볶음', '해물파전', '동동주', '직접 입력...'] },
                { name: '효자동 솥뚜껑 의왕내손점', distance: '도보 15분', menus: ['삼겹살', '목살', '솥뚜껑 삼겹살', '직접 입력...'] },
                { name: '교촌치킨 내손갈뫼점', distance: '도보 15~20분', menus: ['허니콤보', '레드콤보', '오리지날', '반반 오리지날', '살살치킨', '파닭', '웨지감자', '다양한 치킨 메뉴', '직접 입력...'] },
                { name: '처갓집양념치킨 내손갈뫼점', distance: '도보 15~20분', menus: ['슈프림양념치킨', '양념치킨', '후라이드', '간장치킨', '반반 메뉴', '다양한 치킨 메뉴', '직접 입력...'] },
                { name: 'BBQ 계원대점', distance: '도보 15~20분', menus: ['황금올리브치킨', '황금올리브치킨 순살', '자메이카 통다리구이', '다양한 치킨 메뉴', '직접 입력...'] },
                { name: '이조왕순대국', distance: '도보 15~20분', menus: ['순대국', '오소리국밥', '순대볶음', '술국', '직접 입력...'] },
                { name: '자담치킨 의왕계원대학점', distance: '도보 20분', menus: ['맵슐랭 치킨', '치요링 치킨', '후라이드', '양념', '반반 메뉴', '다양한 치킨 메뉴', '직접 입력...'] },
                { name: '광수네감자탕순대국', distance: '도보 20분', menus: ['감자탕', '순대국', '뼈해장국', '뼈찜', '뼈다귀찜', '직접 입력...'] },
                { name: '닭갈비한마당', distance: '도보 20분', menus: ['닭갈비', '볶음밥', '직접 입력...'] },
                { name: '송골전통집', distance: '도보 20분', menus: ['솥밥 정식', '비빔밥', '해물파전', '묵사발', '직접 입력...'] },
                { name: '시골밥상 한식뷔페', distance: '도보 20분', menus: ['한식 뷔페 (매일 반찬 변경)', '반찬 판매', '직접 입력...'] },
                { name: '지리산 토속촌', distance: '도보 20분', menus: ['김치찌개', '보쌈', '전골', '한식', '직접 입력...'] }
            ],
            '학식당': [
                { name: '학식당', distance: '계원예술대학교', menus: ['부대찌게', '갈비탕', '돈까스', '떡볶이', '떡라면', '치킨마요덮밥', '로제라볶이'] }
            ],
            '디저트': [
                { name: '띵크어바웃커피', distance: '도보 5~10분', menus: ['아메리카노', '카페라떼', '다양한 커피 메뉴', '음료', '직접 입력...'] },
                { name: '빽다방 의왕계원예대점', distance: '도보 5~10분', menus: ['아메리카노', '원조커피', '깔라만시 에이드', '옥수크림', '빽스치노', '몽블랑', '꿀밤라떼', '다양한 커피 및 음료', '디저트', '직접 입력...'] },
                { name: '커피케어', distance: '도보 10~15분', menus: ['커피', '음료', '직접 입력...'] },
                { name: '구월제과', distance: '도보 10~15분', menus: ['우유식빵', '소금빵', '바게트', '다양한 빵 메뉴', '구움 과자', '직접 입력...'] },
                { name: '보네르 의왕', distance: '도보 10~15분', menus: ['식빵', '다양한 빵 메뉴', '직접 입력...'] },
                { name: '남매카페', distance: '도보 15분', menus: ['스모어쿠키', '크로플', '베이글', '스콘', '쿠키', '허니브레드', '마카롱', '케이크', '모닝토스트', '다양한 디저트 메뉴', '직접 입력...'] },
                { name: '카페만월경 의왕내손점', distance: '도보 15분', menus: ['고구마라떼', '고래로로쉐 (리얼초코라떼+헤이즐넛)', '다양한 커피와 음료', '간단한 디저트', '직접 입력...'] },
                { name: '요거프레소 의왕계원예대점', distance: '도보 15분', menus: ['요거트 아이스크림', '다양한 음료와 디저트', '직접 입력...'] },
                { name: '더벤티 의왕포일점', distance: '도보 15분', menus: ['다양한 커피 및 음료 메뉴', '직접 입력...'] },
                { name: '메가커피 계원예대점', distance: '도보 15분', menus: ['커피', '음료', '직접 입력...'] }
            ]
        };

        const departments = [
            '디자인학과', '영상학과', '미디어디자인학과', '회화과', '사진학과',
            '만화애니메이션학과', '게임콘텐츠학과', '공연예술학과', '패션디자인학과', '산업디자인학과'
        ];

        const keywords = [
            '양 많음', '양 적음', '빨리 나옴', '가성비 좋음', '조용함',
            '혼밥 가능', '불친절', '청결함', '재방문 의사 있음'
        ];

        // ============================================
        // 🎯 상태 관리 (State Management)
        // ============================================
        
        // 선택된 값 저장
        let selectedTime = '';
        let selectedMood = '';
        let selectedVisuals = [];
        let selectedKeywords = [];
        let currentSelectedCategory = null; // 현재 선택된 카테고리
        let ratingScores = {
            taste: 0,
            portion: 0,
            value: 0,
            service: 0
        };

        // Google Apps Script API URL (배포된 웹 앱 URL)
        const API_URL = 'https://script.google.com/macros/s/AKfycbwIy5M9KOuz5QIlHAxCVsyDddyJArMUI-MWL6fJfKJRNUDLMJEqZDjqgUJK3geGDECi/exec';

        // ============================================
        // 🖥️ 화면 관리 (Screen Management)
        // ============================================
        
        // 화면 전환 함수 (React 스타일)
        function showScreen(screenId) {
            // 모든 화면 숨기기
            const screens = document.querySelectorAll('.screen');
            for (let i = 0; i < screens.length; i++) {
                screens[i].classList.remove('active');
            }
            
            // 선택한 화면 표시
            const targetScreen = document.getElementById(screenId + 'Screen');
            if (targetScreen) {
                targetScreen.classList.add('active');
            }
            
            // 모든 네비게이션 버튼의 active 클래스 제거
            const allNavItems = document.querySelectorAll('.nav-item');
            for (let i = 0; i < allNavItems.length; i++) {
                allNavItems[i].classList.remove('active');
            }
            
            // 현재 화면에 해당하는 네비게이션 버튼에 active 클래스 추가
            const activeNavItems = document.querySelectorAll(`.nav-item[data-view="${screenId}"]`);
            for (let i = 0; i < activeNavItems.length; i++) {
                activeNavItems[i].classList.add('active');
            }
            
            // 네비게이션 바 표시/숨김 제어 (홈, 지도, 트렌드 화면에서 표시)
            const allNavs = document.querySelectorAll('.bottom-nav');
            for (let i = 0; i < allNavs.length; i++) {
                if (screenId === 'home' || screenId === 'map' || screenId === 'trend') {
                    allNavs[i].classList.add('show');
                } else {
                    allNavs[i].classList.remove('show');
                }
            }
            
            // 화면별 데이터 로드
            if (screenId === 'trend') {
                loadTrendData();
            } else if (screenId === 'map') {
                loadMapData();
            }
        }

        // ============================================
        // 🎨 UI 초기화 및 이벤트 핸들러
        // ============================================
        
        // 인기 식당 탭 클릭 이벤트
        document.addEventListener('DOMContentLoaded', function() {
            // 인기 식당 탭 버튼 클릭 이벤트
            const tabButtons = document.querySelectorAll('.tab-btn[data-period]');
            tabButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // 모든 탭 버튼에서 active 제거
                    tabButtons.forEach(b => b.classList.remove('active'));
                    // 클릭한 버튼에 active 추가
                    this.classList.add('active');
                    
                    // 인기 식당 업데이트
                    const records = recordsCache || [];
                    updatePopularRestaurants(records);
                });
            });
            
            // 초기 인기 식당 표시 (예시)
            showExamplePopularRestaurants();
        });
        
        // 인기 식당 탭 클릭 이벤트 초기화
        function initPopularRestaurantTabs() {
            const tabButtons = document.querySelectorAll('.tab-btn[data-period]');
            tabButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // 모든 탭 버튼에서 active 제거
                    tabButtons.forEach(b => b.classList.remove('active'));
                    // 클릭한 버튼에 active 추가
                    this.classList.add('active');
                    
                    // 인기 식당 업데이트
                    const records = recordsCache || [];
                    updatePopularRestaurants(records);
                });
            });
        }
        
        // 카테고리 버튼 클릭 이벤트
        document.addEventListener('DOMContentLoaded', function() {
            // 인기 식당 탭 이벤트 초기화
            initPopularRestaurantTabs();
            
            // 초기 인기 식당 표시 (예시)
            showExamplePopularRestaurants();
            
            // 초기 이달의 식당 랭킹 표시 (예시)
            showExampleMonthlyRanking();
            
            // 초기 인기 키워드 표시 (예시)
            showExampleKeywords();
            
            const categoryButtons = document.querySelectorAll('.category-btn');
            categoryButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    currentSelectedCategory = category; // 카테고리 저장
                    
                    // 기록 화면으로 전환하고 카테고리 전달
                    showScreen('record');
                    // 화면 전환 후 약간의 지연을 두고 식당 목록 로드
                    setTimeout(() => {
                        loadRestaurants(category);
                    }, 100);
                });
            });

            // 식당 선택 시 메뉴 로드 및 다음 단계 표시
            const restaurantSelect = document.getElementById('restaurantSelect');
            if (restaurantSelect) {
                restaurantSelect.addEventListener('change', function() {
                    if (this.value) {
                        loadMenus(this.value);
                        // 메뉴 섹션 표시
                        const menuSection = document.getElementById('menuSection');
                        if (menuSection) {
                            menuSection.style.display = 'block';
                            menuSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }
                    } else {
                        // 식당 선택 취소 시 메뉴 섹션 숨기기
                        document.getElementById('menuSection').style.display = 'none';
                    }
                });
            }

            // 메뉴 선택 시 학과 섹션 표시
            const menuSelect = document.getElementById('menuSelect');
            if (menuSelect) {
                menuSelect.addEventListener('change', function() {
                    if (this.value) {
                        const departmentSection = document.getElementById('departmentSection');
                        if (departmentSection) {
                            departmentSection.style.display = 'block';
                            departmentSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }
                    } else {
                        document.getElementById('departmentSection').style.display = 'none';
                    }
                });
            }

            // 학과 선택 시 소요 시간 및 기분 섹션 표시
            const departmentSelect = document.getElementById('departmentSelect');
            if (departmentSelect) {
                departmentSelect.addEventListener('change', function() {
                    if (this.value) {
                        const timeSection = document.getElementById('timeSection');
                        const moodSection = document.getElementById('moodSection');
                        if (timeSection) {
                            timeSection.style.display = 'block';
                            timeSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }
                        if (moodSection) {
                            moodSection.style.display = 'block';
                        }
                    } else {
                        document.getElementById('timeSection').style.display = 'none';
                        document.getElementById('moodSection').style.display = 'none';
                    }
                });
            }

            // 식당 추가 요청 버튼
            const addRestaurantBtn = document.getElementById('addRestaurantBtn');
            const customRestaurantInput = document.getElementById('customRestaurantInput');
            const submitCustomBtn = document.getElementById('submitCustomRestaurant');
            const cancelCustomBtn = document.getElementById('cancelCustomRestaurant');
            const customRestaurantName = document.getElementById('customRestaurantName');

            if (addRestaurantBtn) {
                addRestaurantBtn.addEventListener('click', function() {
                    customRestaurantInput.style.display = 'block';
                    customRestaurantName.focus();
                });
            }

            if (submitCustomBtn) {
                submitCustomBtn.addEventListener('click', function() {
                    const restaurantName = customRestaurantName.value.trim();
                    if (restaurantName) {
                        // 사용자 입력 식당을 선택 목록에 추가
                        const option = document.createElement('option');
                        option.value = restaurantName;
                        option.textContent = restaurantName + ' (직접 입력)';
                        option.setAttribute('data-menus', JSON.stringify(['직접 입력...']));
                        option.setAttribute('data-custom', 'true');
                        restaurantSelect.appendChild(option);
                        restaurantSelect.value = restaurantName;
                        loadMenus(restaurantName);
                        
                        // 입력 필드 숨기기 및 초기화
                        customRestaurantInput.style.display = 'none';
                        customRestaurantName.value = '';
                        
                        alert('식당이 추가되었습니다! 메뉴는 "직접 입력..." 옵션을 선택하여 입력해주세요.');
                    } else {
                        alert('식당 이름을 입력해주세요.');
                    }
                });
            }

            if (cancelCustomBtn) {
                cancelCustomBtn.addEventListener('click', function() {
                    customRestaurantInput.style.display = 'none';
                    customRestaurantName.value = '';
                });
            }

            // 학과 목록 로드
            loadDepartments();
            
            // 키워드 로드
            loadKeywords();
            
            // 상세 평가 로드
            loadRatings();

            // 지도 화면 카테고리 필터 생성
            initMapFilters();

            // 지도 카드 닫기 버튼
            const closeCardBtn = document.getElementById('closeCardBtn');
            const restaurantCard = document.getElementById('restaurantCard');
            // 카드 닫기 함수
            function closeRestaurantCard() {
                const restaurantCard = document.getElementById('restaurantCard');
                if (restaurantCard) {
                    restaurantCard.classList.remove('show', 'full', 'peek');
                    restaurantCard.style.transform = 'translateX(-50%) translateY(100%)';
                    
                    // 배경 오버레이 숨기기
                    const overlay = document.getElementById('bottomSheetOverlay');
                    if (overlay) {
                        overlay.classList.remove('show');
                    }
                    
                    // 카테고리 리스트 다시 표시
                    const categoryList = document.getElementById('categoryRestaurantList');
                    if (categoryList) {
                        categoryList.style.display = 'block';
                    }
                    
                    // 리뷰창이 닫힐 때 마커들의 opacity 복원
                    document.querySelectorAll('.restaurant-marker').forEach(marker => {
                        marker.style.opacity = '';
                        marker.style.pointerEvents = '';
                        marker.classList.remove('active');
                    });
                }
            }

            if (closeCardBtn && restaurantCard) {
                closeCardBtn.addEventListener('click', closeRestaurantCard);
            }
            
            // 배경 오버레이 클릭 시 카드 닫기
            const overlay = document.getElementById('bottomSheetOverlay');
            if (overlay) {
                overlay.addEventListener('click', closeRestaurantCard);
            }
            
            // 카드 핸들 드래그 기능 (위로 올리면 리뷰 보이기)
            const cardHandle = document.querySelector('.card-handle');
            if (cardHandle && restaurantCard) {
                let isDragging = false;
                let startY = 0;
                let startTransform = 0;
                let hasDragged = false;
                
                // 카드 핸들 클릭 시 peek <-> full 전환 (네이버 지도 스타일)
                cardHandle.addEventListener('click', function(e) {
                    // 드래그가 발생하지 않은 경우만 클릭 처리
                    if (!hasDragged) {
                        if (restaurantCard.classList.contains('peek')) {
                            // peek -> full
                            restaurantCard.classList.remove('peek');
                            restaurantCard.classList.add('show', 'full');
                            restaurantCard.style.transform = 'translateX(-50%) translateY(0)';
                            
                            // 카테고리 리스트 숨기기
                            const categoryList = document.getElementById('categoryRestaurantList');
                            if (categoryList) {
                                categoryList.style.display = 'none';
                            }
                        } else if (restaurantCard.classList.contains('show')) {
                            // full -> peek
                            restaurantCard.classList.remove('show', 'full');
                            restaurantCard.classList.add('peek');
                            restaurantCard.style.transform = 'translateX(-50%) translateY(40%)';
                        }
                    }
                    hasDragged = false;
                });
                
                const handleStart = (clientY) => {
                    isDragging = true;
                    hasDragged = false;
                    startY = clientY;
                    const currentTransform = restaurantCard.style.transform;
                    if (currentTransform && currentTransform !== 'none') {
                        // translateX(-50%) translateY(...) 형식에서 translateY 값 추출
                        const match = currentTransform.match(/translateY\(([^)]+)\)/);
                        if (match) {
                            let value = match[1];
                            // calc() 값 처리
                            if (value.includes('calc')) {
                                if (value.includes('100% - 150px')) {
                                    // peek 상태 (구버전)
                                    startTransform = window.innerHeight - 150;
                                } else if (value.includes('100% - 50px')) {
                                    // 닫힌 상태
                                    startTransform = window.innerHeight - 50;
                                } else {
                                    startTransform = window.innerHeight * 0.4; // 60% 보이도록
                                }
                            } else if (value.includes('%')) {
                                // 퍼센트 값 처리 (40% = 화면의 60% 보임)
                                const percent = parseFloat(value.replace('%', ''));
                                startTransform = window.innerHeight * (percent / 100);
                            } else {
                                value = value.replace('px', '');
                                startTransform = parseFloat(value) || window.innerHeight * 0.4;
                            }
                        } else {
                            // 기본값: peek 상태 (화면의 60% 보이도록)
                            startTransform = window.innerHeight * 0.4;
                        }
                    } else {
                        // 기본값: peek 상태 (화면의 60% 보이도록)
                        startTransform = window.innerHeight * 0.4;
                    }
                    restaurantCard.style.transition = 'none';
                };
                
                const handleMove = (clientY) => {
                    if (!isDragging) return;
                    const deltaY = startY - clientY;
                    // 드래그가 발생했음을 표시 (5px 이상 움직임)
                    if (Math.abs(deltaY) > 5) {
                        hasDragged = true;
                    }
                    const newY = startTransform - deltaY;
                    const minY = 0; // full 상태
                    const maxY = window.innerHeight - 50; // 완전히 닫힌 상태
                    const clampedY = Math.max(minY, Math.min(maxY, newY));
                    restaurantCard.style.transform = `translateX(-50%) translateY(${clampedY}px)`;
                };
                
                const handleEnd = () => {
                    if (!isDragging) return;
                    isDragging = false;
                    restaurantCard.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                    
                    // translateX(-50%) translateY(...) 형식에서 translateY 값 추출
                    const transformMatch = restaurantCard.style.transform.match(/translateY\(([^)]+)\)/);
                    let currentY = 0;
                        if (transformMatch) {
                            const value = transformMatch[1];
                            if (value.includes('calc')) {
                                if (value.includes('100% - 150px')) {
                                    // peek 상태 (구버전)
                                    currentY = window.innerHeight - 150;
                                } else {
                                    currentY = window.innerHeight * 0.4; // 60% 보이도록
                                }
                            } else if (value.includes('%')) {
                                // 퍼센트 값 처리 (40% = 화면의 60% 보임)
                                const percent = parseFloat(value.replace('%', ''));
                                currentY = window.innerHeight * (percent / 100);
                            } else {
                                currentY = parseFloat(value.replace('px', '')) || 0;
                            }
                        }
                    
                    const cardHeight = restaurantCard.offsetHeight;
                    const peekY = window.innerHeight * 0.4; // peek 상태 Y 위치 (화면의 60% 보이도록)
                    const fullY = 0; // full 상태 Y 위치
                    const midPoint = (peekY + fullY) / 2; // 중간 지점
                    
                    // 네이버 지도 스타일: 스냅 포인트 결정
                    if (currentY < midPoint) {
                        // 위로 올렸으면 full 상태
                        restaurantCard.classList.remove('peek');
                        restaurantCard.classList.add('show', 'full');
                        restaurantCard.style.transform = 'translateX(-50%) translateY(0)';
                        
                        // 배경 오버레이 표시
                        const overlay = document.getElementById('bottomSheetOverlay');
                        if (overlay) {
                            overlay.classList.add('show');
                        }
                        
                        // 카테고리 리스트 숨기기
                        const categoryList = document.getElementById('categoryRestaurantList');
                        if (categoryList) {
                            categoryList.style.display = 'none';
                        }
                        
                        // 리뷰창이 열릴 때 마커들의 opacity 낮추기
                        document.querySelectorAll('.restaurant-marker').forEach(marker => {
                            if (!marker.classList.contains('active')) {
                                marker.style.opacity = '0.3';
                                marker.style.pointerEvents = 'none';
                            } else {
                                marker.style.opacity = '0.6';
                            }
                        });
                    } else if (currentY < peekY + 50) {
                        // peek 상태로 스냅
                        restaurantCard.classList.remove('show', 'full');
                        restaurantCard.classList.add('peek');
                        restaurantCard.style.transform = 'translateX(-50%) translateY(40%)';
                    } else {
                        // 너무 아래로 내렸으면 닫기
                        closeRestaurantCard();
                    }
                };
                
                cardHandle.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    handleStart(e.clientY);
                });
                
                cardHandle.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    handleStart(e.touches[0].clientY);
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                    handleMove(e.clientY);
                });
                
                document.addEventListener('touchmove', (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                    handleMove(e.touches[0].clientY);
                });
                
                document.addEventListener('mouseup', () => {
                    handleEnd();
                });
                
                document.addEventListener('touchend', () => {
                    handleEnd();
                });
            }

            // 하단 네비게이션 지도 버튼
            document.querySelectorAll('[data-view="map"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    showScreen('map');
                });
            });

            // 트렌드 화면 탭 버튼
            const trendTabButtons = document.querySelectorAll('.tab-btn');
            trendTabButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    trendTabButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const period = this.getAttribute('data-period');
                    // 탭에 따른 데이터 필터링 로직은 나중에 구현
                    console.log('기간 선택:', period);
                });
            });

            // 하단 네비게이션 트렌드 버튼
            document.querySelectorAll('[data-view="trend"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    showScreen('trend');
                });
            });

            // 기록 완료 버튼 클릭
            const submitBtn = document.getElementById('submitBtn');
            if (submitBtn) {
                submitBtn.addEventListener('click', async function(e) {
                    e.preventDefault(); // 기본 동작 방지
                    console.log('기록 완료 버튼 클릭됨');
                    
                    // 필수 필드 검증
                    const restaurant = document.getElementById('restaurantSelect').value;
                    const menu = document.getElementById('menuSelect').value;
                    const department = document.getElementById('departmentSelect').value;

                    if (!restaurant || !menu || !department) {
                        showToast('필수 항목을 모두 입력해주세요.', 'error');
                        return;
                    }

                    if (!selectedMood) {
                        showToast('기분을 선택해주세요.', 'error');
                        return;
                    }

                    if (ratingScores.taste === 0 || ratingScores.portion === 0 || 
                        ratingScores.value === 0 || ratingScores.service === 0) {
                        showToast('상세 평가를 모두 입력해주세요.', 'error');
                        return;
                    }

                    // 현재 선택된 카테고리 가져오기
                    const currentCategory = currentSelectedCategory || '미지정';
                    console.log('선택된 카테고리:', currentCategory);

                    // 데이터 수집 (React 파일과 동일한 구조)
                    const formData = {
                        timestamp: new Date().toISOString(),
                        category: currentCategory,
                        restaurant: restaurant,
                        menu: menu,
                        department: department,
                        mood: selectedMood,
                        taste: ratingScores.taste,
                        portion: ratingScores.portion,
                        value: ratingScores.value,
                        service: ratingScores.service,
                        keywords: selectedKeywords.join(', '),
                        review: '', // 리뷰는 나중에 추가
                        time: selectedTime || '',
                        visuals: selectedVisuals.join(', ')
                    };

                    console.log('제출할 데이터:', formData);
                    console.log('선택된 값들:', {
                        restaurant: restaurant,
                        menu: menu,
                        department: department,
                        mood: selectedMood,
                        ratingScores: ratingScores,
                        keywords: selectedKeywords
                    });
                    console.log('API URL:', API_URL);

                    try {
                        // API URL이 설정되지 않았으면 경고
                        if (API_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                            showToast('Google Apps Script API URL을 설정해주세요.', 'error');
                            console.log('제출할 데이터:', formData);
                            return;
                        }

                        // POST 요청
                        console.log('API 요청 시작...');
                        console.log('API URL:', API_URL);
                        console.log('전송할 데이터:', JSON.stringify(formData));
                        
                        let response;
                        try {
                            // 일반 POST 요청 시도
                            response = await fetch(API_URL, {
                                method: 'POST',
                                headers: { 
                                    'Content-Type': 'application/json' 
                                },
                                body: JSON.stringify(formData)
                            });
                            
                            console.log('응답 상태:', response.status);
                            console.log('응답 OK:', response.ok);
                            
                            if (response.ok) {
                                const result = await response.json();
                                console.log('응답 받음:', result);
                                
                                if (result.success) {
                                    showToast('식사가 기록되었습니다! 🎉', 'success');
                                    
                                    // 폼 초기화
                                    resetForm();
                                    
                                    // 홈 화면으로 이동
                                    setTimeout(() => {
                                        showScreen('home');
                                    }, 500);
                                } else {
                                    showToast('기록 저장 중 오류가 발생했습니다: ' + (result.error || '알 수 없는 오류'), 'error');
                                    console.error('서버 오류:', result);
                                }
                            } else {
                                // 응답이 실패했지만 CORS 에러일 수 있으므로 일단 성공으로 처리
                                console.warn('응답 상태가 OK가 아니지만, CORS 문제일 수 있습니다. 상태:', response.status);
                                showToast('식사가 기록되었습니다! 🎉 (응답 확인 불가)', 'success');
                                
                                // 폼 초기화
                                resetForm();
                                
                                // 홈 화면으로 이동
                                setTimeout(() => {
                                    showScreen('home');
                                }, 500);
                            }
                        } catch (fetchError) {
                            // CORS 에러나 네트워크 에러 처리
                            console.error('Fetch 오류:', fetchError);
                            console.error('오류 타입:', fetchError.name);
                            console.error('오류 메시지:', fetchError.message);
                            
                            // CORS 에러인 경우에도 데이터는 전송되었을 수 있음
                            if (fetchError.name === 'TypeError' && fetchError.message.includes('Failed to fetch')) {
                                console.warn('CORS 또는 네트워크 오류로 응답을 받을 수 없지만, 데이터는 전송되었을 수 있습니다.');
                                showToast('식사가 기록되었습니다! 🎉 (응답 확인 불가)', 'success');
                                
                                // 폼 초기화
                                resetForm();
                                
                                // 홈 화면으로 이동
                                setTimeout(() => {
                                    showScreen('home');
                                }, 500);
                            } else {
                                throw fetchError; // 다른 오류는 다시 throw
                            }
                        }

                        console.log('API 요청 완료');
                    } catch (error) {
                        console.error('전체 오류:', error);
                        console.error('오류 스택:', error.stack);
                        showToast('기록 저장 중 오류가 발생했습니다. 다시 시도해주세요.', 'error');
                    }
                });
            } else {
                console.error('submitBtn을 찾을 수 없습니다.');
            }
        });

        // ============================================
        // 🔧 유틸리티 함수 (Utility Functions)
        // ============================================
        
        // 현재 선택된 필터 저장
        let currentMapFilter = '전체';

        // 지도 필터 버튼 초기화
        function initMapFilters() {
            const filterButtons = document.getElementById('mapFilterButtons');
            if (!filterButtons) return;

            // 카테고리별 이모지
            const categoryEmojis = {
                '전체': '🍽️',
                '중식': '🥟',
                '일식': '🍣',
                '한식': '🍚',
                '양식': '🍝',
                '디저트': '🍰',
                '학식당': '🍽️'
            };

            // 카테고리 순서
            const categories = ['전체', '중식', '일식', '한식', '양식', '디저트', '학식당'];

            filterButtons.innerHTML = '';

            categories.forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'map-filter-btn';
                btn.setAttribute('data-filter', category);
                if (category === '전체') {
                    btn.classList.add('active');
                }

                btn.innerHTML = `
                    <span class="filter-emoji">${categoryEmojis[category] || '🍽️'}</span>
                    <span class="filter-text">${category}</span>
                    <span class="filter-badge">0</span>
                `;

                btn.addEventListener('click', function() {
                    // 모든 버튼에서 active 제거
                    document.querySelectorAll('.map-filter-btn').forEach(b => b.classList.remove('active'));
                    // 클릭한 버튼에 active 추가
                    this.classList.add('active');
                    
                    // 클릭한 버튼이 보이도록 자동 스크롤
                    const filterButtons = document.getElementById('mapFilterButtons');
                    if (filterButtons) {
                        const containerRect = filterButtons.getBoundingClientRect();
                        const buttonRect = this.getBoundingClientRect();
                        const scrollLeft = filterButtons.scrollLeft;
                        const buttonLeft = buttonRect.left - containerRect.left + scrollLeft;
                        const buttonWidth = buttonRect.width;
                        const containerWidth = containerRect.width;
                        
                        // 버튼이 화면 중앙에 오도록 스크롤
                        const targetScroll = buttonLeft - (containerWidth / 2) + (buttonWidth / 2);
                        
                        filterButtons.scrollTo({
                            left: targetScroll,
                            behavior: 'smooth'
                        });
                    }
                    
                    // 필터링 실행
                    filterMapRestaurants(category);
                });

                filterButtons.appendChild(btn);
            });

            // 초기 필터 적용
            filterMapRestaurants('전체');
        }

        // 지도 식당 필터링
        function filterMapRestaurants(category) {
            currentMapFilter = category;
            
            // 모든 마커 가져오기
            const allMarkers = document.querySelectorAll('.restaurant-marker');
            
            // 카테고리별 식당 개수 계산 (실제 식당 데이터 사용)
            const categoryCounts = {};
            let totalCount = 0;
            Object.keys(restaurants).forEach(cat => {
                const count = restaurants[cat] ? restaurants[cat].length : 0;
                categoryCounts[cat] = count;
                totalCount += count;
            });
            
            // 전체 개수
            categoryCounts['전체'] = totalCount;

            // 배지 업데이트
            document.querySelectorAll('.map-filter-btn').forEach(btn => {
                const filter = btn.getAttribute('data-filter');
                const badge = btn.querySelector('.filter-badge');
                if (badge) {
                    const count = categoryCounts[filter] || 0;
                    badge.textContent = count;
                }
            });

            // 마커 필터링 (표시/숨김)
            allMarkers.forEach(marker => {
                const markerCategory = marker.getAttribute('data-category');
                if (category === '전체' || markerCategory === category) {
                    marker.style.display = 'flex';
                } else {
                    marker.style.display = 'none';
                }
            });
            
            // 식당 리스트 업데이트
            updateRestaurantList(category);
            
            // 카테고리별 식당 리스트도 필터링하여 업데이트
            renderCategoryRestaurantList(category);
            
            console.log('필터링:', category);
        }

        // 카테고리별 식당 리스트 생성 (필터 적용)
        function renderCategoryRestaurantList(selectedCategory = '전체') {
            const container = document.getElementById('categoryRestaurantList');
            if (!container) return;
            
            container.innerHTML = '';
            
            // 카테고리별 이모지
            const categoryEmojis = {
                '중식': '🥟',
                '일식': '🍣',
                '한식': '🍚',
                '양식': '🍝',
                '디저트': '🍰',
                '학식당': '🍽️'
            };
            
            // 카테고리 순서 정의 (전체 제외)
            const categoryOrder = ['중식', '일식', '한식', '양식', '디저트', '학식당'];
            
            // 필터링된 카테고리 목록
            const categoriesToShow = selectedCategory === '전체' 
                ? categoryOrder 
                : [selectedCategory];
            
            // 각 카테고리별로 섹션 생성
            categoriesToShow.forEach(category => {
                const categoryRestaurants = restaurants[category] || [];
                if (categoryRestaurants.length === 0) return;
                
                // 섹션 생성
                const section = document.createElement('div');
                section.className = 'category-section';
                
                // 헤더
                const header = document.createElement('div');
                header.className = 'category-section-header';
                header.innerHTML = `
                    <h2 class="category-section-title">
                        ${category} <span class="category-section-count">${categoryRestaurants.length}개</span>
                    </h2>
                `;
                
                // 식당 리스트
                const itemsContainer = document.createElement('div');
                itemsContainer.className = 'category-restaurant-items';
                
                categoryRestaurants.forEach(restaurant => {
                    const item = document.createElement('div');
                    item.className = 'restaurant-list-item';
                    item.setAttribute('data-restaurant', restaurant.name);
                    item.setAttribute('data-category', category);
                    
                    item.innerHTML = `
                        <div class="restaurant-list-item-content">
                            <div class="restaurant-list-item-left">
                                <div class="restaurant-list-emoji">${categoryEmojis[category] || '🍽️'}</div>
                                <div class="restaurant-list-info">
                                    <h3 class="restaurant-list-name">${restaurant.name}</h3>
                                    <p class="restaurant-list-distance">📍 ${restaurant.distance}</p>
                                </div>
                            </div>
                            <div class="restaurant-list-arrow">→</div>
                        </div>
                    `;
                    
                    // 클릭 이벤트
                    item.addEventListener('click', function() {
                        const restaurantCard = document.getElementById('restaurantCard');
                        if (restaurantCard) {
                            // 캐시된 데이터를 즉시 사용 (로딩 없이)
                            const records = recordsCache || [];
                            const reviews = records.filter(r => r.Restaurant === restaurant.name);
                            updateRestaurantCard(restaurant.name, reviews, restaurant);
                            // 네이버 지도 스타일: 처음에는 peek 상태로 표시 (화면의 60% 보이도록)
                            restaurantCard.classList.add('peek');
                            restaurantCard.style.transform = 'translateX(-50%) translateY(40%)';
                            
                            // 배경 오버레이 표시 (약하게)
                            const overlay = document.getElementById('bottomSheetOverlay');
                            if (overlay) {
                                overlay.classList.add('show');
                            }
                            
                            // 카테고리 리스트 숨기기 (중복 방지)
                            const categoryList = document.getElementById('categoryRestaurantList');
                            if (categoryList) {
                                categoryList.style.display = 'none';
                            }
                            
                            // 리뷰창이 열릴 때 마커들의 opacity 낮추기
                            document.querySelectorAll('.restaurant-marker').forEach(marker => {
                                if (marker.getAttribute('data-restaurant') !== restaurant.name) {
                                    marker.style.opacity = '0.3';
                                    marker.style.pointerEvents = 'none';
                                } else {
                                    marker.classList.add('active');
                                    marker.style.opacity = '0.6';
                                }
                            });
                        }
                    });
                    
                    itemsContainer.appendChild(item);
                });
                
                section.appendChild(header);
                section.appendChild(itemsContainer);
                container.appendChild(section);
            });
        }

        // 식당 리스트 업데이트
        function updateRestaurantList(category) {
            const listContent = document.getElementById('restaurantListContent');
            const listTitle = document.getElementById('listTitle');
            const listCount = document.getElementById('listCount');
            
            if (!listContent) return;
            
            // 모든 식당 수집
            const allRestaurants = [];
            Object.keys(restaurants).forEach(cat => {
                restaurants[cat].forEach(restaurant => {
                    allRestaurants.push({
                        ...restaurant,
                        category: cat
                    });
                });
            });
            
            // 필터링
            const filteredRestaurants = category === '전체' 
                ? allRestaurants 
                : allRestaurants.filter(r => r.category === category);
            
            // 제목 및 개수 업데이트
            if (listTitle) {
                listTitle.textContent = category === '전체' ? '주변 식당' : category;
            }
            if (listCount) {
                listCount.textContent = `(${filteredRestaurants.length}개)`;
            }
            
            // 리스트 내용 업데이트
            listContent.innerHTML = '';
            
            filteredRestaurants.forEach(restaurant => {
                const item = document.createElement('div');
                item.className = 'restaurant-list-item';
                item.setAttribute('data-restaurant', restaurant.name);
                
                // 카테고리별 이모지
                const categoryEmojis = {
                    '중식': '🥟',
                    '일식': '🍣',
                    '한식': '🍚',
                    '양식': '🍝',
                    '디저트': '🍰',
                    '학식당': '🍽️'
                };
                
                item.innerHTML = `
                    <div class="restaurant-list-item-content">
                        <div class="restaurant-list-item-left">
                            <div class="restaurant-list-emoji">${categoryEmojis[restaurant.category] || '🍽️'}</div>
                            <div class="restaurant-list-info">
                                <h3 class="restaurant-list-name">${restaurant.name}</h3>
                                <p class="restaurant-list-distance">📍 ${restaurant.distance}</p>
                            </div>
                        </div>
                        <div class="restaurant-list-arrow">→</div>
                    </div>
                `;
                
                // 클릭 이벤트
                item.addEventListener('click', function() {
                    const restaurantCard = document.getElementById('restaurantCard');
                    if (restaurantCard) {
                        // 캐시된 데이터를 즉시 사용 (로딩 없이)
                        const records = recordsCache || [];
                        const reviews = records.filter(r => r.Restaurant === restaurant.name);
                        updateRestaurantCard(restaurant.name, reviews, restaurant);
                        // 네이버 지도 스타일: 처음에는 peek 상태로 표시 (화면의 60% 보이도록)
                        restaurantCard.classList.add('peek');
                        restaurantCard.style.transform = 'translateX(-50%) translateY(40%)';
                        
                        // 배경 오버레이 표시 (약하게)
                        const overlay = document.getElementById('bottomSheetOverlay');
                        if (overlay) {
                            overlay.classList.add('show');
                        }
                        
                        // 카테고리 리스트 숨기기 (중복 방지)
                        const categoryList = document.getElementById('categoryRestaurantList');
                        if (categoryList) {
                            categoryList.style.display = 'none';
                        }
                        
                        // 리뷰창이 열릴 때 마커들의 opacity 낮추기
                        document.querySelectorAll('.restaurant-marker').forEach(marker => {
                            if (marker.getAttribute('data-restaurant') !== restaurant.name) {
                                marker.style.opacity = '0.3';
                                marker.style.pointerEvents = 'none';
                            } else {
                                marker.classList.add('active');
                                marker.style.opacity = '0.6';
                            }
                        });
                    }
                });
                
                listContent.appendChild(item);
            });
        }

        // 식당 목록 로드
        function loadRestaurants(category) {
            const select = document.getElementById('restaurantSelect');
            if (!select) return;
            
            select.innerHTML = '<option value="">식당을 선택하세요</option>';
            const categoryRestaurants = restaurants[category] || [];
            
            categoryRestaurants.forEach(restaurant => {
                const option = document.createElement('option');
                option.value = restaurant.name;
                option.textContent = `${restaurant.name} (${restaurant.distance})`;
                option.setAttribute('data-menus', JSON.stringify(restaurant.menus));
                select.appendChild(option);
            });
            
            select.disabled = false;
        }

        // 메뉴 목록 로드
        function loadMenus(restaurantName) {
            const select = document.getElementById('menuSelect');
            if (!select) return;
            
            const restaurantOption = document.querySelector(`#restaurantSelect option[value="${restaurantName}"]`);
            if (!restaurantOption) return;
            
            const menus = JSON.parse(restaurantOption.getAttribute('data-menus') || '[]');
            select.innerHTML = '<option value="">메뉴를 선택하세요</option>';
            
            menus.forEach(menu => {
                const option = document.createElement('option');
                option.value = menu;
                option.textContent = menu;
                if (menu === '직접 입력...') {
                    option.setAttribute('data-custom-menu', 'true');
                }
                select.appendChild(option);
            });
            
            select.disabled = false;
            
            // 직접 입력 옵션 선택 이벤트 리스너 제거 후 재등록 (중복 방지)
            const newSelect = select.cloneNode(true);
            select.parentNode.replaceChild(newSelect, select);
            
            const menuSelect = document.getElementById('menuSelect');
            
            // 직접 입력 옵션 처리
            menuSelect.addEventListener('change', function() {
                if (this.value === '직접 입력...') {
                    const menuName = prompt('메뉴 이름을 입력해주세요:');
                    if (menuName && menuName.trim()) {
                        // 직접 입력한 메뉴로 옵션 교체
                        this.value = menuName.trim();
                        const selectedOption = this.options[this.selectedIndex];
                        if (selectedOption) {
                            selectedOption.textContent = menuName.trim();
                        }
                    } else {
                        this.value = '';
                    }
                }
                
                // 학과 섹션 표시 (메뉴 선택 시)
                if (this.value) {
                    const departmentSection = document.getElementById('departmentSection');
                    if (departmentSection) {
                        departmentSection.style.display = 'block';
                        setTimeout(() => {
                            departmentSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }, 100);
                    }
                } else {
                    const departmentSection = document.getElementById('departmentSection');
                    if (departmentSection) {
                        departmentSection.style.display = 'none';
                    }
                }
            });
        }

        // 학과 목록 로드
        function loadDepartments() {
            const select = document.getElementById('departmentSelect');
            if (!select) return;
            
            departments.forEach(dept => {
                const option = document.createElement('option');
                option.value = dept;
                option.textContent = dept;
                select.appendChild(option);
            });
        }

        // 키워드 로드
        function loadKeywords() {
            const container = document.getElementById('keywordContainer');
            if (!container) return;
            
            // 기존 키워드 제거 (중복 방지)
            container.innerHTML = '';
            
            keywords.forEach(keyword => {
                const badge = document.createElement('button');
                badge.className = 'keyword-badge';
                badge.textContent = keyword;
                badge.setAttribute('data-keyword', keyword);
                // 이벤트 리스너는 전역 클릭 이벤트에서 처리하므로 여기서는 추가하지 않음
                container.appendChild(badge);
            });
        }

        // 상세 평가 로드
        function loadRatings() {
            const container = document.getElementById('ratingContainer');
            if (!container) return;
            
            const ratingCategories = [
                { emoji: '🍜', label: '맛', id: 'taste' },
                { emoji: '🍽️', label: '양', id: 'portion' },
                { emoji: '💰', label: '가성비', id: 'value' },
                { emoji: '😊', label: '서비스/분위기', id: 'service' }
            ];
            
            ratingCategories.forEach(category => {
                const ratingDiv = document.createElement('div');
                ratingDiv.className = 'rating-item';
                ratingDiv.innerHTML = `
                    <div class="rating-label">
                        <span>${category.emoji} ${category.label}</span>
                        <span class="rating-score" id="${category.id}Score">-</span>
                    </div>
                    <div class="rating-stars" id="${category.id}Stars">
                        ${[1,2,3,4,5].map(i => `<button class="star-btn" data-rating="${i}" data-category="${category.id}" aria-label="${i}점">☆</button>`).join('')}
                    </div>
                `;
                container.appendChild(ratingDiv);
            });
            
            // 별점 클릭 이벤트
            container.querySelectorAll('.star-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const rating = parseInt(this.getAttribute('data-rating'));
                    const category = this.getAttribute('data-category');
                    updateRating(category, rating);
                });
            });
        }

        // 별점 업데이트
        function updateRating(category, rating) {
            ratingScores[category] = rating; // ratingScores 업데이트
            const scoreEl = document.getElementById(category + 'Score');
            if (scoreEl) scoreEl.textContent = rating + '점';
            
            const stars = document.querySelectorAll(`#${category}Stars .star-btn`);
            stars.forEach((star, index) => {
                const starRating = parseInt(star.getAttribute('data-rating'));
                if (starRating <= rating) {
                    star.classList.add('active');
                    star.innerHTML = '⭐'; // 채워진 별
                } else {
                    star.classList.remove('active');
                    star.innerHTML = '☆'; // 빈 별
                }
            });
            
            // 모든 평가가 완료되면 다음 섹션 표시
            if (ratingScores.taste > 0 && ratingScores.portion > 0 && 
                ratingScores.value > 0 && ratingScores.service > 0) {
                const visualSection = document.getElementById('visualSection');
                const keywordSection = document.getElementById('keywordSection');
                const photoSection = document.getElementById('photoSection');
                
                if (visualSection) {
                    visualSection.style.display = 'block';
                    setTimeout(() => {
                        visualSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 100);
                }
                if (keywordSection) {
                    keywordSection.style.display = 'block';
                    // 키워드 섹션이 표시될 때 키워드 로드 (컨테이너가 존재하는지 확인)
                    const keywordContainer = document.getElementById('keywordContainer');
                    if (keywordContainer && keywordContainer.children.length === 0) {
                        loadKeywords();
                    }
                }
                if (photoSection) {
                    photoSection.style.display = 'block';
                }
            }
        }

        // ============================================
        // 🖱️ 사용자 인터랙션 핸들러
        // ============================================
        
        // 소요 시간 버튼 클릭
        document.addEventListener('click', function(e) {
            if (e.target.closest('.time-btn')) {
                const btn = e.target.closest('.time-btn');
                document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedTime = btn.getAttribute('data-time');
            }

            // 기분 버튼 클릭 시 상세 평가 섹션 표시
            if (e.target.closest('.mood-btn')) {
                const btn = e.target.closest('.mood-btn');
                document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedMood = btn.getAttribute('data-mood');
                
                // 상세 평가 섹션 표시
                const ratingSection = document.getElementById('ratingSection');
                if (ratingSection) {
                    ratingSection.style.display = 'block';
                    setTimeout(() => {
                        ratingSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 100);
                    
                }
            }

            // 시각 평가 버튼 클릭
            if (e.target.closest('.visual-btn')) {
                const btn = e.target.closest('.visual-btn');
                btn.classList.toggle('active');
                const visual = btn.textContent.trim();
                if (btn.classList.contains('active')) {
                    if (!selectedVisuals.includes(visual)) {
                        selectedVisuals.push(visual);
                    }
                } else {
                    selectedVisuals = selectedVisuals.filter(v => v !== visual);
                }
            }
        });

        // ============================================
        // 📸 사진 업로드 기능
        // ============================================
        
        let selectedPhoto = null; // 선택된 사진 저장
        
        document.addEventListener('DOMContentLoaded', function() {
            // 페이지 로드 시 데이터 미리 로드 (백그라운드, 로딩 표시 없이)
            preloadData();
            
            const photoInput = document.getElementById('photoInput');
            const photoUploadArea = document.getElementById('photoUploadArea');
            const photoPreview = document.getElementById('photoPreview');
            const photoPreviewImg = document.getElementById('photoPreviewImg');
            const photoUploadText = document.getElementById('photoUploadText');
            
            // 사진 업로드 영역 클릭 시 파일 선택
            if (photoUploadArea && photoInput) {
                photoUploadArea.addEventListener('click', function() {
                    photoInput.click();
                });
            }
            
            // 파일 선택 시 미리보기 표시
            if (photoInput) {
                photoInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        // 파일 크기 확인 (5MB 제한)
                        if (file.size > 5 * 1024 * 1024) {
                            showToast('사진 크기는 5MB 이하여야 합니다.', 'error');
                            return;
                        }
                        
                        // 이미지 파일인지 확인
                        if (!file.type.startsWith('image/')) {
                            showToast('이미지 파일만 업로드 가능합니다.', 'error');
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            selectedPhoto = e.target.result; // Base64로 저장
                            if (photoPreview && photoPreviewImg) {
                                photoPreviewImg.src = selectedPhoto;
                                photoPreview.style.display = 'block';
                                if (photoUploadText) {
                                    photoUploadText.textContent = '사진 변경하기';
                                }
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        });

        // ============================================
        // 📝 폼 관리 함수 (Form Management)
        // ============================================
        
        // 폼 초기화
        function resetForm() {
            document.getElementById('restaurantSelect').value = '';
            document.getElementById('menuSelect').value = '';
            document.getElementById('menuSelect').disabled = true;
            document.getElementById('departmentSelect').value = '';
            selectedTime = '';
            selectedMood = '';
            selectedVisuals = [];
            selectedKeywords = [];
            ratingScores = { taste: 0, portion: 0, value: 0, service: 0 };

            document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.visual-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.keyword-badge').forEach(b => b.classList.remove('active'));
            
            // 별점 초기화
            ['taste', 'portion', 'value', 'service'].forEach(category => {
                const scoreEl = document.getElementById(category + 'Score');
                if (scoreEl) scoreEl.textContent = '-';
                const stars = document.querySelectorAll(`#${category}Stars .star-btn`);
                stars.forEach(star => {
                    star.classList.remove('active');
                    star.innerHTML = '☆';
                });
            });
        }

        // 키워드 선택
        document.addEventListener('click', function(e) {
            if (e.target.closest('.keyword-badge')) {
                const badge = e.target.closest('.keyword-badge');
                badge.classList.toggle('active');
                const keyword = badge.getAttribute('data-keyword') || badge.textContent.trim();
                
                if (badge.classList.contains('active')) {
                    if (!selectedKeywords.includes(keyword)) {
                        selectedKeywords.push(keyword);
                    }
                } else {
                    selectedKeywords = selectedKeywords.filter(k => k !== keyword);
                }
                
                console.log('선택된 키워드:', selectedKeywords);
            }
        });

        // 데이터 조회 함수 (트렌드, 지도 화면용)
        // ============================================
        // 📡 API 통신 함수 (API Communication)
        // ============================================
        
        // 데이터 캐싱
        let recordsCache = null;
        let recordsCacheTime = 0;
        const CACHE_DURATION = 30000; // 30초 캐시

        async function loadRecords(forceRefresh = false) {
            if (API_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                console.log('API URL이 설정되지 않았습니다.');
                return [];
            }

            // 캐시 확인
            const now = Date.now();
            if (!forceRefresh && recordsCache && (now - recordsCacheTime) < CACHE_DURATION) {
                return recordsCache;
            }

            try {
                const response = await fetch(API_URL);
                if (response.ok) {
                    const data = await response.json();
                    recordsCache = data;
                    recordsCacheTime = now;
                    return data;
                } else {
                    throw new Error('데이터 조회 실패');
                }
            } catch (error) {
                console.error('데이터 조회 오류:', error);
                // 캐시된 데이터가 있으면 반환
                if (recordsCache) {
                    return recordsCache;
                }
                return [];
            }
        }

        // 트렌드 화면 데이터 로드
        async function loadTrendData() {
            const records = await loadRecords();
            if (records.length === 0) {
                // 데이터가 없을 때 예시 표시
                showExamplePopularRestaurants();
                showExampleMonthlyRanking();
                showExampleKeywords();
                return;
            }

            // 오늘 기록 수 업데이트
            const today = new Date().toDateString();
            const todayRecords = records.filter(r => {
                const recordDate = new Date(r.Timestamp).toDateString();
                return recordDate === today;
            });
            const todayCountEl = document.querySelector('.stat-value');
            if (todayCountEl) {
                todayCountEl.textContent = todayRecords.length + '건';
            }

            // 평균 평점 계산
            const avgRating = records.reduce((sum, r) => {
                return sum + (parseFloat(r.TasteRating) || 0);
            }, 0) / records.length;
            const avgRatingEl = document.querySelector('.stat-rating span');
            if (avgRatingEl) {
                avgRatingEl.textContent = avgRating.toFixed(1);
            }

            // 인기 식당 계산
            const restaurantCounts = {};
            todayRecords.forEach(r => {
                if (r.Restaurant) {
                    restaurantCounts[r.Restaurant] = (restaurantCounts[r.Restaurant] || 0) + 1;
                }
            });

            // 인기 키워드 업데이트
            updatePopularKeywords(records);

            // 최근 기록 표시
            updateRecentRecords(records.slice(0, 3));
            
            // 인기 식당 업데이트
            updatePopularRestaurants(records);
            
            // 이달의 식당 랭킹 업데이트
            updateMonthlyRanking(records);
            
            // 인기 키워드 업데이트
            updatePopularKeywords(records);
        }
        
        // 인기 키워드 업데이트
        function updatePopularKeywords(records) {
            if (!records || records.length === 0) {
                // 데이터가 없을 때 예시 표시
                showExampleKeywords();
                return;
            }
            
            // 키워드 통계 계산
            const keywordCounts = {};
            records.forEach(r => {
                if (r.Keywords) {
                    // 쉼표로 구분된 키워드 파싱
                    const keywords = r.Keywords.split(',').map(k => k.trim()).filter(k => k);
                    keywords.forEach(k => {
                        keywordCounts[k] = (keywordCounts[k] || 0) + 1;
                    });
                }
            });
            
            // 키워드를 빈도순으로 정렬
            const sortedKeywords = Object.keys(keywordCounts)
                .map(keyword => ({
                    text: keyword,
                    count: keywordCounts[keyword]
                }))
                .sort((a, b) => b.count - a.count)
                .slice(0, 6); // 상위 6개만 표시
            
            // HTML 업데이트
            const container = document.getElementById('popularKeywordsList');
            if (!container) return;
            
            if (sortedKeywords.length === 0) {
                showExampleKeywords();
                return;
            }
            
            container.innerHTML = sortedKeywords.map(keyword => {
                return `
                    <div class="keyword-item">
                        <span class="keyword-text">${keyword.text}</span>
                        <span class="keyword-count">(${keyword.count})</span>
                    </div>
                `;
            }).join('');
        }
        
        // 예시 인기 키워드 표시 (데이터가 없을 때)
        function showExampleKeywords() {
            const container = document.getElementById('popularKeywordsList');
            if (!container) return;
            
            const exampleKeywords = [
                { text: '가성비 좋음', count: 156 },
                { text: '양 많음', count: 143 },
                { text: '빨리 나옴', count: 128 },
                { text: '혼밥 가능', count: 112 },
                { text: '단골될 듯', count: 98 },
                { text: '매움', count: 87 }
            ];
            
            container.innerHTML = exampleKeywords.map(keyword => {
                return `
                    <div class="keyword-item">
                        <span class="keyword-text">${keyword.text}</span>
                        <span class="keyword-count">(${keyword.count})</span>
                    </div>
                `;
            }).join('');
        }
        
        // 인기 식당 탭 클릭 이벤트 초기화
        function initPopularRestaurantTabs() {
            const tabButtons = document.querySelectorAll('.tab-btn[data-period]');
            tabButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // 모든 탭 버튼에서 active 제거
                    tabButtons.forEach(b => b.classList.remove('active'));
                    // 클릭한 버튼에 active 추가
                    this.classList.add('active');
                    
                    // 인기 식당 업데이트
                    const records = recordsCache || [];
                    updatePopularRestaurants(records);
                });
            });
        }
        
        // 인기 식당 계산 및 표시
        function updatePopularRestaurants(records) {
            if (!records || records.length === 0) {
                // 데이터가 없을 때 예시 표시
                showExamplePopularRestaurants();
                return;
            }
            
            // 현재 선택된 기간 확인
            const activeTab = document.querySelector('.tab-btn.active');
            const period = activeTab ? activeTab.getAttribute('data-period') : 'today';
            
            // 기간별 데이터 필터링
            const now = new Date();
            let filteredRecords = [];
            
            if (period === 'today') {
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                filteredRecords = records.filter(r => {
                    const recordDate = new Date(r.Timestamp);
                    return recordDate >= today;
                });
            } else if (period === 'week') {
                const weekAgo = new Date(now);
                weekAgo.setDate(weekAgo.getDate() - 7);
                filteredRecords = records.filter(r => {
                    const recordDate = new Date(r.Timestamp);
                    return recordDate >= weekAgo;
                });
            } else if (period === 'month') {
                const monthAgo = new Date(now);
                monthAgo.setMonth(monthAgo.getMonth() - 1);
                filteredRecords = records.filter(r => {
                    const recordDate = new Date(r.Timestamp);
                    return recordDate >= monthAgo;
                });
            }
            
            // 식당별 통계 계산
            const restaurantStats = {};
            filteredRecords.forEach(r => {
                if (r.Restaurant) {
                    if (!restaurantStats[r.Restaurant]) {
                        restaurantStats[r.Restaurant] = {
                            count: 0,
                            totalRating: 0,
                            ratings: []
                        };
                    }
                    restaurantStats[r.Restaurant].count++;
                    const rating = parseFloat(r.TasteRating) || 0;
                    if (rating > 0) {
                        restaurantStats[r.Restaurant].totalRating += rating;
                        restaurantStats[r.Restaurant].ratings.push(rating);
                    }
                }
            });
            
            // 평균 평점 계산 및 정렬
            const restaurantList = Object.keys(restaurantStats).map(name => {
                const stats = restaurantStats[name];
                const avgRating = stats.ratings.length > 0 
                    ? (stats.totalRating / stats.ratings.length).toFixed(1)
                    : '0.0';
                return {
                    name: name,
                    count: stats.count,
                    avgRating: parseFloat(avgRating)
                };
            }).sort((a, b) => {
                // 리뷰 수가 같으면 평점으로 정렬, 다르면 리뷰 수로 정렬
                if (b.count === a.count) {
                    return b.avgRating - a.avgRating;
                }
                return b.count - a.count;
            }).slice(0, 3); // 상위 3개만
            
            // HTML 업데이트
            const container = document.getElementById('popularRestaurantsContent');
            if (!container) return;
            
            if (restaurantList.length === 0) {
                showExamplePopularRestaurants();
                return;
            }
            
            const rankBadges = ['gold', 'silver', 'bronze'];
            const emojis = ['🏮', '🌶️', '🔥', '🍽️', '🍜', '🍱'];
            
            container.innerHTML = restaurantList.map((restaurant, index) => {
                const rankBadge = rankBadges[index] || 'bronze';
                const emoji = emojis[index % emojis.length];
                
                return `
                    <div class="popular-restaurant-item">
                        <div class="rank-badge ${rankBadge}">${index + 1}</div>
                        <div class="restaurant-emoji-small">${emoji}</div>
                        <div class="restaurant-info-small">
                            <div class="restaurant-name-small">${restaurant.name}</div>
                            <div class="restaurant-count">${restaurant.count}건</div>
                        </div>
                        <div class="restaurant-rating-small">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 1L10 6L16 6L11 9L13 14L8 11L3 14L5 9L0 6L6 6L8 1Z" fill="#FF6B4A"/>
                            </svg>
                            <span>${restaurant.avgRating.toFixed(1)}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // 예시 인기 식당 표시 (데이터가 없을 때)
        function showExamplePopularRestaurants() {
            const container = document.getElementById('popularRestaurantsContent');
            if (!container) return;
            
            const exampleRestaurants = [
                { name: '황제짬뽕', count: 23, rating: 4.8, emoji: '🏮', badge: 'gold' },
                { name: '저스트카츠 의왕점', count: 18, rating: 4.7, emoji: '🌶️', badge: 'silver' },
                { name: '프랭크버거 의왕내손점', count: 15, rating: 4.7, emoji: '🔥', badge: 'bronze' }
            ];
            
            container.innerHTML = exampleRestaurants.map((restaurant, index) => {
                return `
                    <div class="popular-restaurant-item">
                        <div class="rank-badge ${restaurant.badge}">${index + 1}</div>
                        <div class="restaurant-emoji-small">${restaurant.emoji}</div>
                        <div class="restaurant-info-small">
                            <div class="restaurant-name-small">${restaurant.name}</div>
                            <div class="restaurant-count">${restaurant.count}건</div>
                        </div>
                        <div class="restaurant-rating-small">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 1L10 6L16 6L11 9L13 14L8 11L3 14L5 9L0 6L6 6L8 1Z" fill="#FF6B4A"/>
                            </svg>
                            <span>${restaurant.rating}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // 이달의 식당 랭킹 업데이트
        function updateMonthlyRanking(records) {
            if (!records || records.length === 0) {
                // 데이터가 없을 때 예시 표시
                showExampleMonthlyRanking();
                return;
            }
            
            // 이번 달 데이터 필터링
            const now = new Date();
            const monthAgo = new Date(now);
            monthAgo.setMonth(monthAgo.getMonth() - 1);
            
            const monthlyRecords = records.filter(r => {
                const recordDate = new Date(r.Timestamp);
                return recordDate >= monthAgo;
            });
            
            // 식당별 통계 계산
            const restaurantStats = {};
            monthlyRecords.forEach(r => {
                if (r.Restaurant) {
                    if (!restaurantStats[r.Restaurant]) {
                        restaurantStats[r.Restaurant] = {
                            count: 0,
                            totalRating: 0,
                            ratings: [],
                            menus: {},
                            distance: null
                        };
                    }
                    restaurantStats[r.Restaurant].count++;
                    const rating = parseFloat(r.TasteRating) || 0;
                    if (rating > 0) {
                        restaurantStats[r.Restaurant].totalRating += rating;
                        restaurantStats[r.Restaurant].ratings.push(rating);
                    }
                    
                    // 메뉴 통계
                    if (r.Menu) {
                        restaurantStats[r.Restaurant].menus[r.Menu] = (restaurantStats[r.Restaurant].menus[r.Menu] || 0) + 1;
                    }
                    
                    // 거리 정보 (식당 데이터에서 찾기)
                    if (!restaurantStats[r.Restaurant].distance) {
                        for (const category in restaurants) {
                            const found = restaurants[category].find(rest => rest.name === r.Restaurant);
                            if (found) {
                                restaurantStats[r.Restaurant].distance = found.distance;
                                break;
                            }
                        }
                    }
                }
            });
            
            // 평균 평점 계산 및 정렬
            const restaurantList = Object.keys(restaurantStats).map(name => {
                const stats = restaurantStats[name];
                const avgRating = stats.ratings.length > 0 
                    ? (stats.totalRating / stats.ratings.length).toFixed(1)
                    : '0.0';
                
                // 베스트 메뉴 찾기
                const bestMenu = Object.keys(stats.menus).reduce((a, b) => 
                    stats.menus[a] > stats.menus[b] ? a : b, Object.keys(stats.menus)[0]
                ) || '메뉴 없음';
                
                return {
                    name: name,
                    count: stats.count,
                    avgRating: parseFloat(avgRating),
                    bestMenu: bestMenu,
                    distance: stats.distance || '정보 없음'
                };
            }).sort((a, b) => {
                // 리뷰 수가 같으면 평점으로 정렬, 다르면 리뷰 수로 정렬
                if (b.count === a.count) {
                    return b.avgRating - a.avgRating;
                }
                return b.count - a.count;
            }).slice(0, 10); // 상위 10개
            
            // HTML 업데이트
            const container = document.getElementById('monthlyRankingList');
            if (!container) return;
            
            if (restaurantList.length === 0) {
                showExampleMonthlyRanking();
                return;
            }
            
            const rankBadges = ['gold', 'silver', 'bronze'];
            const rankColors = ['gold', 'silver', 'bronze'];
            const emojis = ['🏮', '🌶️', '🔥', '🍽️', '🍜', '🍱', '🥟', '🍣', '🍚', '🍝'];
            
            container.innerHTML = restaurantList.map((restaurant, index) => {
                const rankBadge = rankBadges[index] || 'bronze';
                const emoji = emojis[index % emojis.length];
                const isFeatured = index === 0;
                
                return `
                    <div class="ranking-item ${isFeatured ? 'featured' : ''}">
                        <div class="ranking-header">
                            <div class="rank-number ${rankBadge}">${index + 1}</div>
                            ${index === 0 ? '<div class="rank-change up"><svg width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M6 0L7.5 4.5L12 4.5L8.5 7.5L10 12L6 9L2 12L3.5 7.5L0 4.5L4.5 4.5L6 0Z" fill="#22C55E"/></svg>12%</div>' : ''}
                        </div>
                        <div class="ranking-restaurant">
                            <div class="restaurant-emoji-large">${emoji}</div>
                            <div class="ranking-info">
                                <div class="ranking-name">${restaurant.name}</div>
                                <div class="ranking-distance-badge">${restaurant.distance}</div>
                            </div>
                        </div>
                        <div class="ranking-details">
                            <div class="detail-item">
                                <span>평점</span>
                                <span class="detail-value">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M8 1L10 6L16 6L11 9L13 14L8 11L3 14L5 9L0 6L6 6L8 1Z" fill="#FF6B4A"/>
                                    </svg>
                                    ${restaurant.avgRating.toFixed(1)}
                                </span>
                            </div>
                            <div class="detail-item">
                                <span>리뷰 수</span>
                                <span class="detail-value">${restaurant.count}개</span>
                            </div>
                            <div class="detail-item">
                                <span>베스트 메뉴</span>
                                <span class="detail-value highlight">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M8 0L10 4L14 4L11 7L12 12L8 9L4 12L5 7L2 4L6 4L8 0Z" fill="#F59E0B"/>
                                    </svg>
                                    ${restaurant.bestMenu}
                                </span>
                            </div>
                        </div>
                        ${isFeatured ? `
                        <div class="ranking-badge-special">
                            <span>🎉</span>
                            <span>이달의 최고 인기 식당!</span>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            // 페이지네이션 도트 업데이트 (최대 5개)
            updateRankingPagination(Math.min(restaurantList.length, 5));
        }
        
        // 페이지네이션 도트 업데이트
        function updateRankingPagination(totalItems) {
            const pagination = document.getElementById('rankingPagination');
            if (!pagination) return;
            
            pagination.innerHTML = '';
            // 최대 5개의 도트만 표시
            const dotCount = Math.min(totalItems, 5);
            for (let i = 0; i < dotCount; i++) {
                const dot = document.createElement('div');
                dot.className = `ranking-dot ${i === 0 ? 'active' : ''}`;
                pagination.appendChild(dot);
            }
            
            // 스크롤 이벤트로 활성 도트 업데이트
            const container = document.querySelector('.ranking-list-container');
            if (container) {
                container.addEventListener('scroll', function() {
                    const scrollLeft = container.scrollLeft;
                    const cardWidth = container.querySelector('.ranking-item')?.offsetWidth || 0;
                    const gap = 16;
                    const activeIndex = Math.round(scrollLeft / (cardWidth + gap));
                    
                    pagination.querySelectorAll('.ranking-dot').forEach((dot, index) => {
                        dot.classList.toggle('active', index === activeIndex);
                    });
                });
            }
        }
        
        // 예시 이달의 식당 랭킹 표시 (데이터가 없을 때)
        function showExampleMonthlyRanking() {
            const container = document.getElementById('monthlyRankingList');
            if (!container) return;
            
            const exampleRestaurants = [
                { name: '황제짬뽕', count: 342, rating: 4.7, bestMenu: '황제짬뽕', distance: '도보 10분', emoji: '🏮', badge: 'gold' },
                { name: '저스트카츠 의왕점', count: 298, rating: 4.6, bestMenu: '등심카츠 정식', distance: '도보 5~10분', emoji: '🌶️', badge: 'silver' },
                { name: '프랭크버거 의왕내손점', count: 267, rating: 4.6, bestMenu: '프랭크버거', distance: '도보 5~10분', emoji: '🔥', badge: 'bronze' },
                { name: '멘구락부 의왕', count: 245, rating: 4.5, bestMenu: '쇼유라멘', distance: '도보 10분', emoji: '🍜', badge: 'bronze' },
                { name: '일지오 페페', count: 223, rating: 4.5, bestMenu: '까르보나라 파스타', distance: '도보 10분', emoji: '🍝', badge: 'bronze' }
            ];
            
            container.innerHTML = exampleRestaurants.map((restaurant, index) => {
                const isFeatured = index === 0;
                
                return `
                    <div class="ranking-item ${isFeatured ? 'featured' : ''}">
                        <div class="ranking-header">
                            <div class="rank-number ${restaurant.badge}">${index + 1}</div>
                            ${isFeatured ? '<div class="rank-change up">↗ 최고</div>' : ''}
                        </div>
                        <div class="ranking-restaurant">
                            <div class="restaurant-emoji-large">${restaurant.emoji}</div>
                            <div class="ranking-info">
                                <div class="ranking-name">${restaurant.name}</div>
                                <div class="ranking-distance-badge">${restaurant.distance}</div>
                            </div>
                        </div>
                        <div class="ranking-details">
                            <div class="detail-item">
                                <span>평점</span>
                                <span class="detail-value">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M8 1L10 6L16 6L11 9L13 14L8 11L3 14L5 9L0 6L6 6L8 1Z" fill="#FF6B4A"/>
                                    </svg>
                                    ${restaurant.rating}
                                </span>
                            </div>
                            <div class="detail-item">
                                <span>리뷰 수</span>
                                <span class="detail-value">${restaurant.count}개</span>
                            </div>
                            <div class="detail-item">
                                <span>베스트 메뉴</span>
                                <span class="detail-value highlight">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M8 0L10 4L14 4L11 7L12 12L8 9L4 12L5 7L2 4L6 4L8 0Z" fill="#F59E0B"/>
                                    </svg>
                                    ${restaurant.bestMenu}
                                </span>
                            </div>
                        </div>
                        ${isFeatured ? `
                        <div class="ranking-badge-special">
                            <span>🎉</span>
                            <span>이달의 최고 인기 식당!</span>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            // 페이지네이션 도트 업데이트 (최대 5개)
            updateRankingPagination(Math.min(exampleRestaurants.length, 5));
        }
        
        // 인기 식당 탭 클릭 이벤트 초기화
        function initPopularRestaurantTabs() {
            const tabButtons = document.querySelectorAll('.tab-btn[data-period]');
            tabButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // 모든 탭 버튼에서 active 제거
                    tabButtons.forEach(b => b.classList.remove('active'));
                    // 클릭한 버튼에 active 추가
                    this.classList.add('active');
                    
                    // 인기 식당 업데이트
                    const records = recordsCache || [];
                    updatePopularRestaurants(records);
                });
            });
        }

        // 최근 기록 업데이트
        function updateRecentRecords(records) {
            const container = document.querySelector('.recent-records');
            if (!container) return;

            container.innerHTML = '';
            records.forEach(record => {
                const recordItem = document.createElement('div');
                recordItem.className = 'record-item';
                
                const moodEmojis = {
                    '행복': '😊',
                    '만족함': '😋',
                    '보통': '😐',
                    '별로': '😔',
                    '나른함': '🤤',
                    '화남': '😤'
                };

                const stars = '⭐'.repeat(Math.round(parseFloat(record.TasteRating) || 0));
                const keywords = record.Keywords ? record.Keywords.split(', ') : [];
                const timeAgo = getTimeAgo(new Date(record.Timestamp));

                recordItem.innerHTML = `
                    <div class="record-header">
                        <div class="record-left">
                            <div class="record-emoji">${moodEmojis[record.Mood] || '😊'}</div>
                            <div class="record-info">
                                <div class="record-menu">${record.Menu || ''}</div>
                                <div class="record-restaurant">
                                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M6 1L7 6L12 6L8 9L9 14L6 11L3 14L4 9L0 6L5 6L6 1Z" fill="#FD4B21"/>
                                    </svg>
                                    <span>${record.Restaurant || ''}</span>
                                </div>
                            </div>
                        </div>
                        <div class="record-stars">${stars}</div>
                    </div>
                    <div class="record-content">${record.Keywords || ''}</div>
                    <div class="record-keywords">
                        ${keywords.map(k => `<span class="keyword-badge-small">${k}</span>`).join('')}
                    </div>
                    <div class="record-footer">
                        <span class="record-author">익명 · ${record.Department || ''}</span>
                        <span class="record-time">${timeAgo}</span>
                    </div>
                `;
                container.appendChild(recordItem);
            });
        }

        // 시간 경과 계산
        function getTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 1) return '방금 전';
            if (minutes < 60) return minutes + '분 전';
            if (hours < 24) return hours + '시간 전';
            return days + '일 전';
        }

        // 지도 화면 데이터 로드 (로딩 없이 즉시 처리)
        function loadMapData() {
            // 카테고리별 식당 리스트 생성 (전체로 초기 표시)
            // 캐시된 데이터를 사용하므로 로딩 없이 즉시 표시
            renderCategoryRestaurantList('전체');
        }
        
        // 페이지 로드 시 데이터 미리 로드 (백그라운드, 로딩 표시 없이)
        function preloadData() {
            if (!recordsCache) {
                loadRecords().catch(err => console.error('데이터 로드 오류:', err));
            }
        }

        // 지도에 식당 마커 표시 (비활성화됨)
        function displayRestaurantMarkers(restaurantReviews) {
            const mapBackground = document.getElementById('mapBackground');
            if (!mapBackground) return;

            // 기존 마커 제거 (학교 마커 제외)
            const existingMarkers = mapBackground.querySelectorAll('.restaurant-marker');
            existingMarkers.forEach(marker => marker.remove());
            
            // 마커 표시 기능 비활성화 - 함수 종료
            return;

            // 모든 카테고리의 식당 수집
            const allRestaurants = [];
            Object.keys(restaurants).forEach(category => {
                restaurants[category].forEach(restaurant => {
                    allRestaurants.push({
                        ...restaurant,
                        category: category
                    });
                });
            });
            
            // 식당 마커 생성 및 배치 (모든 마커 생성)
            // 거리 순서대로 원형 레이어로 배치
            const markerPositions = [];
            const minDistance = 12; // 마커 간 최소 거리 (%)
            
            // 거리별로 그룹화
            const distanceGroups = {};
            allRestaurants.forEach(restaurant => {
                const distance = parseInt(restaurant.distance.match(/\d+/)?.[0] || '15');
                if (!distanceGroups[distance]) {
                    distanceGroups[distance] = [];
                }
                distanceGroups[distance].push(restaurant);
            });
            
            // 거리 순서대로 정렬 (5분, 8분, 10분, 12분...)
            const sortedDistances = Object.keys(distanceGroups).sort((a, b) => parseInt(a) - parseInt(b));
            
            // 각 거리 레이어별로 마커 배치
            sortedDistances.forEach((distanceStr, layerIndex) => {
                const distance = parseInt(distanceStr);
                const group = distanceGroups[distanceStr];
                const groupSize = group.length;
                
                // 거리에 따라 반지름 결정 (5분=25%, 10분=30%, 15분=35%, 20분=40%, 25분=45%)
                const baseRadius = Math.min(25 + (distance - 5) * 1.2, 45);
                
                // 각 레이어마다 약간의 회전 오프셋 (겹침 방지)
                const layerRotation = layerIndex * 0.3;
                
                // 그룹 내 마커들을 균등하게 원형 배치
                group.forEach((restaurant, groupIndex) => {
                    // 그룹 내에서 균등한 각도 분배
                    const angleStep = (2 * Math.PI) / groupSize;
                    const angle = (groupIndex * angleStep) + layerRotation;
                    
                    // 위치 계산
                    let left = 50 + (baseRadius * Math.cos(angle));
                    let top = 50 + (baseRadius * Math.sin(angle));
                    
                    // 기존 마커와의 최소 거리 보장 (최적화: 최대 10번만 시도)
                    let attempts = 0;
                    while (attempts < 10) {
                        let tooClose = false;
                        const checkCount = Math.min(markerPositions.length, 10); // 최근 10개만 체크
                        for (let i = Math.max(0, markerPositions.length - checkCount); i < markerPositions.length; i++) {
                            const existingPos = markerPositions[i];
                            const dx = left - existingPos.left;
                            const dy = top - existingPos.top;
                            const dist = Math.sqrt(dx * dx + dy * dy);
                            if (dist < minDistance) {
                                tooClose = true;
                                // 충돌 시 반지름을 약간 늘려서 배치
                                const currentRadius = Math.sqrt((left - 50) ** 2 + (top - 50) ** 2);
                                const newRadius = currentRadius + (minDistance - dist) + 2;
                                const currentAngle = Math.atan2(top - 50, left - 50);
                                left = 50 + (newRadius * Math.cos(currentAngle));
                                top = 50 + (newRadius * Math.sin(currentAngle));
                                break;
                            }
                        }
                        if (!tooClose) break;
                        attempts++;
                    }
                    
                    // 경계 체크 (지도 영역 내에 유지: 10%~90%)
                    left = Math.max(10, Math.min(90, left));
                    top = Math.max(10, Math.min(90, top));
                    
                    markerPositions.push({ left, top, restaurant });
                });
            });
            
            // 카테고리별 이모지 (한 번만 정의)
            const categoryEmojis = {
                '중식': '🥟',
                '일식': '🍣',
                '한식': '🍚',
                '양식': '🍝',
                '디저트': '🍰',
                '학식당': '🍽️'
            };

            // DocumentFragment 사용하여 DOM 조작 최소화
            const fragment = document.createDocumentFragment();
            
            // 마커 생성 및 배치
            for (let i = 0; i < markerPositions.length; i++) {
                const pos = markerPositions[i];
                const marker = document.createElement('div');
                marker.className = 'restaurant-marker';
                marker.setAttribute('data-restaurant', pos.restaurant.name);
                marker.setAttribute('data-category', pos.restaurant.category);
                marker.textContent = categoryEmojis[pos.restaurant.category] || '🍽️';
                marker.style.left = pos.left + '%';
                marker.style.top = pos.top + '%';
                
                // 마커 클릭 이벤트 (이벤트 위임 대신 개별 등록)
                marker.addEventListener('click', function() {
                    // 모든 마커의 active 클래스 제거
                    const allMarkers = mapBackground.querySelectorAll('.restaurant-marker');
                    for (let j = 0; j < allMarkers.length; j++) {
                        allMarkers[j].classList.remove('active');
                    }
                    
                    // 클릭한 마커에 active 클래스 추가
                    this.classList.add('active');
                    
                    // 해당 식당의 리뷰 가져오기
                    const reviews = restaurantReviews[pos.restaurant.name] || [];
                    
                    // 식당 카드 업데이트 및 표시
                    updateRestaurantCard(pos.restaurant.name, reviews, pos.restaurant);
                    
                    // 카드 표시
                    const restaurantCard = document.getElementById('restaurantCard');
                    if (restaurantCard) {
                        restaurantCard.classList.add('show', 'full');
                        restaurantCard.style.transform = 'translateX(-50%) translateY(0)';
                        
                        // 배경 오버레이 표시
                        const overlay = document.getElementById('bottomSheetOverlay');
                        if (overlay) {
                            overlay.classList.add('show');
                        }
                        
                        // 카테고리 리스트 숨기기 (중복 방지)
                        const categoryList = document.getElementById('categoryRestaurantList');
                        if (categoryList) {
                            categoryList.style.display = 'none';
                        }
                        
                        // 리뷰창이 열릴 때 마커들의 opacity 낮추기
                        for (let j = 0; j < allMarkers.length; j++) {
                            const m = allMarkers[j];
                            if (m.getAttribute('data-restaurant') !== pos.restaurant.name) {
                                m.style.opacity = '0.3';
                                m.style.pointerEvents = 'none';
                            } else {
                                m.style.opacity = '0.6';
                            }
                        }
                    }
                });
                
                fragment.appendChild(marker);
            }
            
            // 한 번에 DOM에 추가
            mapBackground.appendChild(fragment);
            
            // 현재 필터 적용
            filterMapRestaurants(currentMapFilter);
        }

        // 식당 카드 업데이트
        function updateRestaurantCard(restaurantName, reviews, restaurantInfo = null) {
            const restaurantCard = document.getElementById('restaurantCard');
            if (!restaurantCard) return;

            // 식당 정보 업데이트
            const restaurantNameEl = restaurantCard.querySelector('.restaurant-name');
            if (restaurantNameEl) {
                restaurantNameEl.textContent = restaurantName;
            }

            // 식당 이모지 업데이트
            const restaurantEmojiEl = restaurantCard.querySelector('.restaurant-emoji');
            if (restaurantEmojiEl && restaurantInfo) {
                const categoryEmojis = {
                    '중식': '🥟',
                    '일식': '🍣',
                    '한식': '🍚',
                    '양식': '🍝',
                    '디저트': '🍰',
                    '학식당': '🍽️'
                };
                restaurantEmojiEl.textContent = categoryEmojis[restaurantInfo.category] || '🍽️';
            }

            // 거리 정보 업데이트
            const distanceBadge = restaurantCard.querySelector('.distance-badge');
            if (distanceBadge && restaurantInfo) {
                distanceBadge.textContent = restaurantInfo.distance;
            }

            // 메뉴 정보 업데이트
            const menuSection = restaurantCard.querySelector('#cardMenuSection');
            const menuList = restaurantCard.querySelector('#menuList');
            if (menuSection && menuList && restaurantInfo && restaurantInfo.menus) {
                menuList.innerHTML = '';
                // '직접 입력...' 제외하고 메뉴 표시
                const displayMenus = restaurantInfo.menus.filter(menu => menu !== '직접 입력...');
                if (displayMenus.length > 0) {
                    displayMenus.forEach(menu => {
                        const menuItem = document.createElement('div');
                        menuItem.className = 'menu-item';
                        menuItem.innerHTML = `
                            <span class="menu-name">${menu}</span>
                            <span class="menu-price">가격 정보 준비 중</span>
                        `;
                        menuList.appendChild(menuItem);
                    });
                    menuSection.style.display = 'block';
                } else {
                    menuSection.style.display = 'none';
                }
            } else if (menuSection) {
                menuSection.style.display = 'none';
            }

            // 평균 평점 계산
            let avgRating = 0;
            if (reviews.length > 0) {
                avgRating = reviews.reduce((sum, r) => {
                    const taste = parseFloat(r.TasteRating) || 0;
                    const portion = parseFloat(r.PortionRating) || 0;
                    const value = parseFloat(r.ValueRating) || 0;
                    const service = parseFloat(r.ServiceRating) || 0;
                    return sum + (taste + portion + value + service) / 4;
                }, 0) / reviews.length;
            }

            // 평점 업데이트
            const ratingScoreEl = restaurantCard.querySelector('.rating-score');
            if (ratingScoreEl) {
                ratingScoreEl.textContent = avgRating > 0 ? avgRating.toFixed(1) : '0.0';
            }

            // 리뷰 수 업데이트
            const reviewCountEl = restaurantCard.querySelector('.review-count');
            if (reviewCountEl) {
                reviewCountEl.textContent = reviews.length + '개 리뷰';
            }

            // 리뷰 컨테이너 완전히 교체
            const reviewContainer = restaurantCard.querySelector('.card-reviews');
            if (!reviewContainer) return;

            // 리뷰가 없을 때
            if (reviews.length === 0) {
                reviewContainer.innerHTML = `
                    <div class="reviews-header">
                        <span>리뷰 0개</span>
                    </div>
                    <div style="text-align: center; padding: 40px 20px; color: rgba(255, 255, 255, 0.7);">
                        아직 리뷰가 없습니다.<br>
                        첫 번째 리뷰를 작성해보세요!
                    </div>
                `;
                return;
            }

            // 리뷰가 있을 때 - 전체 HTML 재생성
            const moodEmojis = {
                '행복': '😊',
                '만족함': '😋',
                '보통': '😐',
                '별로': '😔',
                '나른함': '🤤',
                '화남': '😤'
            };

            let reviewsHTML = `
                <div class="reviews-header">
                    <span>리뷰 ${reviews.length}개</span>
                </div>
            `;

            // 모든 리뷰 표시
            reviews.forEach(record => {
                // 평균 평점 계산
                const recordAvgRating = (
                    (parseFloat(record.TasteRating) || 0) +
                    (parseFloat(record.PortionRating) || 0) +
                    (parseFloat(record.ValueRating) || 0) +
                    (parseFloat(record.ServiceRating) || 0)
                ) / 4;
                const stars = '⭐'.repeat(Math.round(recordAvgRating));
                const keywords = record.Keywords ? record.Keywords.split(', ').filter(k => k.trim()) : [];
                const timeAgo = getTimeAgo(new Date(record.Timestamp));

                reviewsHTML += `
                    <div class="review-item">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <span class="reviewer-name">익명</span>
                                <span class="divider">·</span>
                                <span class="reviewer-dept">${record.Department || ''}</span>
                            </div>
                            <div class="review-stars">${stars}</div>
                            <div class="review-menu-badge">
                                <span>${record.Menu || ''}</span>
                            </div>
                        </div>
                        <div class="review-time">${timeAgo}</div>
                        <div class="review-content">${record.Review || record.Keywords || '리뷰 내용이 없습니다.'}</div>
                        <div class="review-ratings">
                            <div class="rating-item-small">
                                <span>🍜 맛</span>
                                <span class="rating-point">${record.TasteRating || 0}점</span>
                            </div>
                            <div class="rating-item-small">
                                <span>🍽️ 양</span>
                                <span class="rating-point">${record.PortionRating || 0}점</span>
                            </div>
                            <div class="rating-item-small">
                                <span>💰 가성비</span>
                                <span class="rating-point">${record.ValueRating || 0}점</span>
                            </div>
                            <div class="rating-item-small">
                                <span>😊 서비스</span>
                                <span class="rating-point">${record.ServiceRating || 0}점</span>
                            </div>
                        </div>
                        ${keywords.length > 0 ? `
                        <div class="review-keywords">
                            ${keywords.map(k => `<span class="keyword-badge-small">${k.trim()}</span>`).join('')}
                        </div>
                        ` : ''}
                    </div>
                `;
            });

            reviewContainer.innerHTML = reviewsHTML;
            
            // 스크롤을 맨 위로 초기화
            reviewContainer.scrollTop = 0;
        }

        // Toast 알림 함수 (React 스타일)
        // ============================================
        // 🎨 UI 헬퍼 함수 (UI Helper Functions)
        // ============================================
        
        function showToast(message, type = 'success') {
            // 기존 토스트 제거
            const existingToast = document.querySelector('.toast-message');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = 'toast-message';
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'success' ? '#16a34a' : type === 'error' ? '#dc2626' : '#2d2d44'};
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
                z-index: 10000;
                animation: slideUp 0.3s ease-out;
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideDown 0.3s ease-out';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // CSS 애니메이션 추가
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideUp {
                from {
                    opacity: 0;
                    transform: translate(-50%, 20px);
                }
                to {
                    opacity: 1;
                    transform: translate(-50%, 0);
                }
            }
            @keyframes slideDown {
                from {
                    opacity: 1;
                    transform: translate(-50%, 0);
                }
                to {
                    opacity: 0;
                    transform: translate(-50%, 20px);
                }
            }
            .screen {
                animation: fadeIn 0.3s ease-in;
            }
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
